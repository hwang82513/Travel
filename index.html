<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전주-군산-선유도 3일 여행 플래너 Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        /* 시간 표시 개선 */
        .time-display {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .time-input {
            width: 90px;
            padding: 6px 10px;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            background: white;
            font-size: 16px;
            color: #1e40af;
        }
        
        .time-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        /* 컨트롤 버튼 레이아웃 개선 */
        .control-buttons {
            position: absolute;
            right: 10px;
            top: 10px;
            display: none;
            gap: 4px;
            z-index: 10;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .control-buttons-row {
            display: flex;
            gap: 4px;
        }
        
        .edit-mode .control-buttons {
            display: flex;
        }
        
        /* 버튼 스타일 개선 */
        .control-button {
            font-weight: bold;
            font-size: 16px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .change-button {
            background-color: #3b82f6;
            color: white;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .change-button:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        /* 옵션 편집 버튼 강조 */
        .edit-options-btn {
            background-color: #8b5cf6;
            color: white;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .edit-options-btn:hover {
            background-color: #7c3aed;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        /* 일정 추가 버튼 개선 */
        .add-module-btn {
            border: 3px dashed #3b82f6;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 16px;
            border-radius: 12px;
            font-weight: bold;
            color: #1e40af;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .add-module-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .add-module-btn:hover::before {
            left: 100%;
        }
        
        .add-module-btn:hover {
            border-color: #1d4ed8;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }
        
        /* 빠른 추가 버튼 */
        .quick-add-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .quick-add-btn {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .quick-add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .quick-add-food {
            background-color: #d1fae5;
            color: #065f46;
            border-color: #10b981;
        }
        
        .quick-add-tour {
            background-color: #fef3c7;
            color: #92400e;
            border-color: #f59e0b;
        }
        
        .quick-add-transport {
            background-color: #ede9fe;
            color: #5b21b6;
            border-color: #8b5cf6;
        }
        
        .quick-add-rest {
            background-color: #fee2e2;
            color: #991b1b;
            border-color: #ef4444;
        }
        
        /* 메인 컨트롤 버튼들 */
        .main-control-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            color: white;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .main-control-btn.orange {
            background-color: #f97316;
        }
        
        .main-control-btn.orange:hover {
            background-color: #ea580c;
        }
        
        .main-control-btn.green {
            background-color: #10b981;
        }
        
        .main-control-btn.green:hover {
            background-color: #059669;
        }
        
        .main-control-btn.blue {
            background-color: #3b82f6;
        }
        
        .main-control-btn.blue:hover {
            background-color: #2563eb;
        }
        
        .main-control-btn.red {
            background-color: #ef4444;
        }
        
        .main-control-btn.red:hover {
            background-color: #dc2626;
        }
        
        .main-control-btn.purple {
            background-color: #8b5cf6;
        }
        
        .main-control-btn.purple:hover {
            background-color: #7c3aed;
        }
        
        .module-food { background: linear-gradient(135deg, #10b981, #059669); }
        .module-tour { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .module-hotel { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .module-transport { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .module-special { background: linear-gradient(135deg, #ef4444, #dc2626); }
        
        .option-card {
            transition: all 0.2s ease-out;
            cursor: pointer;
            position: relative;
        }
        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .option-card.selected {
            border: 3px solid #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        .day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .edit-mode {
            border: 3px dashed #f59e0b !important;
            background: rgba(251, 191, 36, 0.1) !important;
            padding-right: 100px !important;
        }
        
        .duration-badge {
            background: rgba(99, 102, 241, 0.1);
            color: #4f46e5;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        /* 소요시간 입력 스타일 개선 */
        .duration-input-wrapper {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            padding: 2px;
        }
        
        .duration-input {
            width: 50px;
            padding: 2px 4px;
            border: none;
            font-size: 12px;
            text-align: center;
            background: transparent;
        }
        
        .duration-input:focus {
            outline: none;
        }
        
        .duration-input-wrapper:focus-within {
            border-color: #3b82f6;
        }
        
        .duration-btn {
            background: #f3f4f6;
            border: none;
            padding: 2px 6px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            color: #4b5563;
            transition: all 0.2s;
        }
        
        .duration-btn:hover {
            background: #e5e7eb;
            color: #1f2937;
        }
        
        .duration-btn:active {
            transform: scale(0.95);
        }
        
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            display: none;
            animation: fadeInOut 2s ease;
            z-index: 1000;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        
        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .animate-slide-in {
            animation: slide-in 0.3s ease-out;
        }
        
        .editable {
            padding: 2px 4px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .editable:hover {
            background: rgba(0,0,0,0.05);
        }
        
        .editable:focus {
            background: rgba(59, 130, 246, 0.1);
            outline: 2px solid #3b82f6;
        }
        
        input[type="checkbox"] {
            cursor: pointer;
        }
        
        input[type="checkbox"]:checked {
            accent-color: #10b981;
        }
        
        .control-buttons button:active {
            transform: scale(0.95);
        }
        
        .moving {
            opacity: 0.7;
            transform: scale(0.98);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .nearby-badge {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        /* 대체일정 섹션 스타일 */
        .alternative-section {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border: 2px dashed #9ca3af;
        }
        
        /* 일정 이동 버튼 */
        .move-to-day-btn {
            background-color: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin: 0 2px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .move-to-day-btn:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }
        
        .move-to-alternative-btn {
            background-color: #6b7280;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .move-to-alternative-btn:hover {
            background-color: #4b5563;
            transform: translateY(-1px);
        }
        
        /* 템플릿 선택 모달 */
        .template-card {
            border: 2px solid #e5e7eb;
            padding: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }
        
        .template-card:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
            transform: translateY(-2px);
        }
        
        .template-card.selected {
            border-color: #3b82f6;
            background-color: #dbeafe;
        }
        
        /* 옵션 편집 모달 스크롤 개선 */
        .modal-content-scrollable {
            max-height: calc(90vh - 120px);
            overflow-y: auto;
            position: relative;
        }
        
        .modal-footer {
            position: sticky;
            bottom: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 16px;
            margin: -16px;
            margin-top: 16px;
        }

        /* 추가: 지역 표시 배지 */
        .location-badge {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        /* 추가: 복수 선택 모드 스타일 */
        .multi-select-mode .option-item {
            position: relative;
            padding-left: 40px;
        }

        .option-checkbox {
            position: absolute;
            left: 12px;
            top: 20px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .selected-options-preview {
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 14px;
            line-height: 1.6;
        }

        .selected-options-preview h5 {
            font-weight: bold;
            margin-bottom: 8px;
            color: #374151;
        }

        .selected-option-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .selected-option-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        /* 옵션 순서 변경 버튼 */
        .option-order-buttons {
            display: flex;
            gap: 4px;
        }
        
        .option-order-btn {
            background-color: #6b7280;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-order-btn:hover {
            background-color: #4b5563;
        }
        
        .option-order-btn:active {
            transform: scale(0.95);
        }

        .option-order-btn:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* 절약 항목 스타일 */
        .saving-items {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            padding: 8px;
            border-radius: 6px;
            margin-top: 8px;
        }

        .saving-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .saving-item input {
            flex: 1;
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
        }

        .saving-item .amount-input {
            width: 80px;
            text-align: right;
        }

        /* 일차 추가 버튼 */
        .add-day-btn {
            background-color: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .add-day-btn:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }

        /* 비용 절약 요약 */
        .cost-summary {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 8px;
        }

        .savings-summary {
            background: #d1fae5;
            border: 1px solid #10b981;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 8px;
        }
        
        @media (max-width: 640px) {
            .container { padding: 0.5rem; }
            .text-lg { font-size: 1rem; }
            .text-xl { font-size: 1.125rem; }
            .control-buttons { 
                position: static;
                margin-top: 8px;
                justify-content: flex-end;
            }
            .time-input { width: 80px; }
            .edit-mode {
                padding-right: 16px !important;
            }
            .quick-add-buttons {
                justify-content: center;
            }
            .modal-content-scrollable {
                max-height: calc(90vh - 100px);
            }
        }

        /* 추가: 모달 내부 스크롤바 스타일링 (부드럽고 시각적 강조) */
        .modal-content-scrollable::-webkit-scrollbar {
            width: 8px;
        }
        .modal-content-scrollable::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .modal-content-scrollable::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 10px;
        }
        .modal-content-scrollable::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }

        /* 추가: 모바일에서 모달 패딩/높이 조정 (스크롤 여유 확보) */
        @media (max-width: 640px) {
            .modal-content-scrollable {
                max-height: calc(90vh - 150px); /* 헤더/푸터 여유 증가 */
                padding-bottom: 20px; /* 하단 스크롤 여유 */
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto max-w-4xl p-4">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2 ${editMode ? 'editable' : ''}" 
                ${editMode ? 'contenteditable="true" onblur="updateMainTitle(this.textContent)"' : ''} id="mainTitle">
                <i class="fas fa-map-marked-alt text-blue-600"></i>
                전주-군산-선유도 3일 여행 플래너 Pro
            </h1>
            <p class="text-center text-gray-600 mb-4">편집모드에서 모든 내용 수정 가능 • 자동 시간 계산 • 인접 관광지 추천</p>
            
            <!-- 여행 개요 -->
            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                <h3 class="font-bold text-blue-900 mb-2">📍 여행 코스 개요</h3>
                <div class="text-sm text-blue-800 space-y-1">
                    <p>• <strong>1일차:</strong> 전주 한옥마을 중심 (경기전, 전동성당, 오목대) + 남부시장 먹거리 + 막걸리골목</p>
                    <p>• <strong>2일차:</strong> 전주→군산 이동, 근대문화유산 (히로시가옥, 동국사, 김치사진관) + 선유도 일몰 + 궁전꽃게장</p>
                    <p>• <strong>3일차:</strong> 군산 마무리 관광 (이성당, 경암동철길마을) → 수원 복귀</p>
                </div>
            </div>
            
            <!-- Stats Bar -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="bg-green-50 p-3 rounded-lg">
                    <div class="text-green-600 font-bold" id="totalSavings">₩0</div>
                    <div class="text-xs text-green-700" id="savingsCategories">투어패스 절약</div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg">
                    <div class="text-blue-600 font-bold" id="totalBudget">₩0</div>
                    <div class="text-xs text-blue-700">예상 총 비용</div>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg">
                    <div class="text-purple-600 font-bold" id="totalItems">31</div>
                    <div class="text-xs text-purple-700">전체 일정</div>
                </div>
                <div class="bg-orange-50 p-3 rounded-lg">
                    <div class="text-orange-600 font-bold" id="editedItems">0</div>
                    <div class="text-xs text-orange-700">변경된 항목</div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div class="flex flex-wrap gap-3 justify-center mb-4">
                <button onclick="toggleEditMode()" class="main-control-btn orange">
                    <i class="fas fa-edit"></i>
                    <span>편집모드</span>
                </button>
                <button onclick="saveSchedule()" class="main-control-btn green">
                    <i class="fas fa-save"></i>
                    <span>저장</span>
                </button>
                <button onclick="exportSchedule()" class="main-control-btn blue">
                    <i class="fas fa-download"></i>
                    <span>내보내기</span>
                </button>
                <button onclick="resetSchedule()" class="main-control-btn red">
                    <i class="fas fa-undo"></i>
                    <span>초기화</span>
                </button>
                <button onclick="recalculateAllTimes()" class="main-control-btn purple">
                    <i class="fas fa-clock"></i>
                    <span>시간 재계산</span>
                </button>
                <button onclick="addNewDay()" class="add-day-btn" style="display: none;" id="addDayBtn">
                    <i class="fas fa-plus-circle"></i>
                    <span>일차 추가</span>
                </button>
            </div>
            
            <!-- 자동 계산 토글 -->
            <div class="flex items-center justify-center gap-4 p-3 bg-gray-100 rounded-lg mb-4">
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" id="autoCalculate" class="mr-2 w-5 h-5" onchange="toggleAutoCalculate()">
                    <span class="font-medium text-gray-700">🔄 이동 시 시간 자동 계산</span>
                </label>
                <span id="autoCalculateStatus" class="text-sm px-3 py-1 rounded-full bg-blue-100 text-blue-800">
                    자동 계산 ON
                </span>
            </div>
            
            <!-- Filter -->
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="filterByType('all')" class="filter-btn px-3 py-1 bg-gray-200 rounded-full text-sm hover:bg-gray-300 transition-colors">전체</button>
                <button onclick="filterByType('food')" class="filter-btn px-3 py-1 bg-green-200 rounded-full text-sm hover:bg-green-300 transition-colors">🍽️ 식사</button>
                <button onclick="filterByType('tour')" class="filter-btn px-3 py-1 bg-yellow-200 rounded-full text-sm hover:bg-yellow-300 transition-colors">🏛️ 관광</button>
                <button onclick="filterByType('hotel')" class="filter-btn px-3 py-1 bg-blue-200 rounded-full text-sm hover:bg-blue-300 transition-colors">🏨 숙박</button>
                <button onclick="filterByType('transport')" class="filter-btn px-3 py-1 bg-purple-200 rounded-full text-sm hover:bg-purple-300 transition-colors">🚗 이동</button>
            </div>
        </div>

        <!-- Schedule -->
        <div id="scheduleContainer">
            <!-- Days will be dynamically generated -->
        </div>

        <!-- Save Indicator -->
        <div class="save-indicator" id="saveIndicator">
            <i class="fas fa-check-circle mr-2"></i> 저장되었습니다!
        </div>

        <!-- Modal for Options (개선된 스크롤 구조) -->
        <div id="optionsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] flex flex-col">
                <div class="p-4 border-b sticky top-0 bg-white z-10">
                    <h3 class="text-lg font-bold" id="modalTitle">옵션 선택</h3>
                    <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-hidden">
                    <div class="p-4">
                        <!-- 복수 선택 모드 토글 -->
                        <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="multiSelectMode" class="mr-2 w-5 h-5" onchange="toggleMultiSelectMode()">
                                <span class="font-medium text-gray-700">복수 선택 모드 (여러 옵션을 동시에 선택)</span>
                            </label>
                        </div>
                        <!-- 선택 버튼 (복수 선택 모드일 때만 표시) -->
                        <div id="multiSelectControls" class="hidden mb-4 flex gap-2">
                            <button onclick="applySelectedOptions()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 font-bold">
                                <i class="fas fa-check mr-2"></i>선택 완료
                            </button>
                            <button onclick="clearSelectedOptions()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                                <i class="fas fa-times mr-2"></i>선택 취소
                            </button>
                        </div>
                        <div class="modal-content-scrollable" id="modalContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Module Modal -->
        <div id="addModuleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
                <div class="p-4 border-b sticky top-0 bg-white">
                    <h3 class="text-lg font-bold">새 일정 추가</h3>
                    <button onclick="closeAddModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <!-- 템플릿 선택 -->
                    <div class="mb-4" id="templateSection">
                        <label class="block text-sm font-medium mb-2">빠른 템플릿 선택</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="selectTemplate('meal')" class="template-card text-left">
                                <div class="font-bold text-green-600 mb-1">🍽️ 식사</div>
                                <div class="text-xs text-gray-600">아침/점심/저녁</div>
                            </button>
                            <button onclick="selectTemplate('tour')" class="template-card text-left">
                                <div class="font-bold text-yellow-600 mb-1">🏛️ 관광</div>
                                <div class="text-xs text-gray-600">명소/체험/쇼핑</div>
                            </button>
                            <button onclick="selectTemplate('transport')" class="template-card text-left">
                                <div class="font-bold text-purple-600 mb-1">🚗 이동</div>
                                <div class="text-xs text-gray-600">버스/택시/도보</div>
                            </button>
                            <button onclick="selectTemplate('rest')" class="template-card text-left">
                                <div class="font-bold text-red-600 mb-1">☕ 휴식</div>
                                <div class="text-xs text-gray-600">카페/휴게소</div>
                            </button>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">시간</label>
                        <input type="time" id="newTime" class="w-full p-2 border rounded" value="12:00">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">활동명</label>
                        <input type="text" id="newActivity" placeholder="활동명 입력" class="w-full p-2 border rounded">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">카테고리</label>
                        <select id="newType" class="w-full p-2 border rounded">
                            <option value="food">🍽️ 식사</option>
                            <option value="tour">🏛️ 관광</option>
                            <option value="hotel">🏨 숙박</option>
                            <option value="transport">🚗 이동</option>
                            <option value="special">⭐ 특별</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">소요시간(분)</label>
                        <input type="number" id="newDuration" placeholder="60" class="w-full p-2 border rounded" value="60">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">상세 설명</label>
                        <textarea id="newDetails" placeholder="상세 설명 입력" class="w-full p-2 border rounded" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">비용(원)</label>
                        <input type="number" id="newCost" placeholder="0" class="w-full p-2 border rounded" value="0">
                    </div>
                    <button onclick="addNewModule()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 font-bold">
                        <i class="fas fa-plus mr-2"></i>일정 추가하기
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Options Modal - 스크롤 개선 -->
        <div id="editOptionsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] flex flex-col">
                <div class="p-4 border-b bg-white">
                    <h3 class="text-lg font-bold">옵션 편집</h3>
                    <button onclick="closeEditOptionsModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-hidden">
                    <div class="p-4 modal-content-scrollable">
                        <div id="optionsList"></div>
                    </div>
                    <div class="modal-footer">
                        <button onclick="addNewOption()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 font-bold">
                            <i class="fas fa-plus mr-2"></i>새 옵션 추가
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced travel data
        const travelData = [
            // Day 1
            { id: 1, day: 1, time: "07:00", duration: 150, activity: "수원 출발 → 전주", type: "transport", module: "🟣이동모듈", status: "✅현재선택", 
              options: [
                {name: "KTX 이용", location: "수원시 → 전주시", details: "🚄 KTX 수원역→익산역→전주 | ⏰ 1시간 30분 | 💰 29,700원 | 📍 익산역에서 전주행 버스 환승(30분) | 🎫 코레일톡 예약 추천", cost: 29700, savings: []},
                {name: "고속버스 이용", location: "수원시 → 전주시", details: "🚌 수원종합버스터미널→전주고속버스터미널 | ⏰ 2시간 | 💰 8,000원 | 📍 10분 간격 운행 | 🎫 버스타고 앱 예약 가능", cost: 8000, savings: []},
                {name: "자가용 직행", location: "수원시 → 전주시", details: "🚗 수원→전주 직행 | ⏰ 2시간 30분 | 💰 유료도로비 약 15,000원 + 주유비 20,000원 | 📍 경부고속도로→논산천안고속도로 | 🅿️ 한옥마을 공영주차장 이용", cost: 35000, savings: []}
              ],
              details: "KTX: 1시간 30분, 29,700원 | 고속버스: 2시간, 8,000원 | 자가용: 2시간 30분, 유료도로비 포함", 
              cost: 29700, saving: 0, selectedOptions: [0] },
            
            { id: 2, day: 1, time: "09:30", duration: 60, activity: "전주 한옥마을 도착 및 둘러보기", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "한옥마을 자유관람", location: "전주시 완산구 교동", details: "🏘️ 700여채 한옥 밀집지역 | 📸 포토스팟: 전동성당, 경기전 돌담길, 오목대 | 🎭 한복체험 15,000원(2시간) | 🗺️ 관광안내소에서 무료 지도 수령 | 💡 오전 일찍 방문시 한적함 | 🏛️ 인접: 경기전, 전동성당, 오목대 모두 도보 5분", cost: 0, savings: [{name: "전북투어패스", amount: 2000}]},
                {name: "한옥스테이 체크인", location: "전주시 완산구 교동", details: "🏡 전통 한옥 숙박 체험 | ⏰ 체크인 15:00 (조기 체크인 가능 문의) | 💰 1박 80,000~150,000원 | 📍 학인당, 동락원 등 추천 | 🍵 웰컴티 서비스 포함", cost: 0, savings: []},
                {name: "전주향교 방문", location: "전주시 완산구 향교길", details: "📚 조선시대 교육기관 | ⏰ 09:00-18:00 | 💰 무료입장 | 📍 한옥마을에서 도보 10분 | 🎓 유생복 체험 가능(5,000원) | 📸 은행나무 포토존 인기 | 🏛️ 인접: 완판본문화관(5분), 한벽당(10분)", cost: 0, savings: []},
                {name: "풍남문+남부시장 코스", location: "전주시 완산구 풍남문", details: "🏛️ 전주읍성 남문 | ⏰ 상시개방 | 💰 무료 | 📍 한옥마을 입구 | 🛍️ 바로 옆 남부시장 연계 관광 | 🍡 시장 먹거리 투어 가능", cost: 0, savings: []}
              ],
              details: "한옥마을 무료 관람, 한복체험 15,000원 추가 가능. 전북투어패스로 관련 시설 할인 혜택. 인접 관광지: 경기전, 전동성당, 오목대 모두 도보권",
              cost: 0, saving: 2000, selectedOptions: [0] },
            
            { id: 3, day: 1, time: "10:30", duration: 90, activity: "경기전 & 전동성당 방문", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "경기전+어진박물관", location: "전주시 완산구 태조로", details: "🏛️ 태조 이성계 어진 봉안 | ⏰ 09:00-19:00 | 💰 일반 3,000원→전북투어패스 무료 | 📍 대나무숲 산책로 필수 코스 | 📸 어진박물관, 부속건물 관람 1시간 소요 | 🏛️ 인접: 전동성당(2분), 경기전사고(내부), 태조로(바로 앞)", cost: 0, savings: [{name: "전북투어패스", amount: 3000}]},
                {name: "전동성당+성당카페", location: "전주시 완산구 태조로", details: "⛪ 한국 천주교 순교성지 | ⏰ 09:00-17:00 | 💰 무료입장 | 📍 로마네스크 양식 건축미 | 📸 웨딩촬영 명소, 스테인드글라스 포토존 | 🕐 미사시간 확인 필요 | ☕ 성당 카페 운영(커피 4,000원) | 🏛️ 인접: 경기전(2분), 풍남문(5분)", cost: 4000, savings: []},
                {name: "오목대+이목대 코스", location: "전주시 완산구 기린대로", details: "🏔️ 한옥마을 전망대 | ⏰ 상시개방 | 💰 무료 | 📍 계단 오르기 10분 | 📸 한옥마을 전경 최고 뷰포인트 | 🌅 일몰 시간대 추천 | 🏛️ 인접: 이목대(도보 3분), 자만벽화마을(5분), 한벽당(15분)", cost: 0, savings: []},
                {name: "한국전통문화전당", location: "전주시 완산구 태조로", details: "🎭 전통문화 체험관 | ⏰ 09:00-21:00 | 💰 체험별 5,000~20,000원 | 📍 한지공예, 전통음식 만들기 | 🎨 사전예약 필수 | 👨‍👩‍👧‍👦 가족체험 프로그램 인기 | 🏛️ 인접: 전주공예품전시관(내부), 부채문화관(3분)", cost: 15000, savings: []},
                {name: "최명희문학관", location: "전주시 완산구 최명희길", details: "📚 혼불 작가 기념관 | ⏰ 09:00-18:00 | 💰 무료 | 📍 한옥마을 중심부 | 📖 혼불 관련 전시 | 🏛️ 인접: 부채문화관(2분), 술박물관(3분)", cost: 0, savings: []}
              ],
              details: "전북투어패스로 경기전 무료입장 (일반 3,000원 → 무료). 조선왕조 역사 체험 가능. 인접 관광지 다수로 효율적 동선 가능",
              cost: 0, saving: 3000, selectedOptions: [0] },
            
            { id: 4, day: 1, time: "12:00", duration: 90, activity: "🍽️ 전주 남부시장 점심식사", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🍜전통국밥", location: "전주시 완산구 남부시장", details: "🥇 현대옥: 콩나물국밥 8,000원 | ⏰ 05:30-15:00(14시 마감주의!) | 📍 남부시장 내 | 💡 김치, 깍두기 리필 무료 | ⭐ 70년 전통, 현지인 추천 1위\n🥈 조점례남문피순대: 순대국밥 9,000원, 피순대 13,000원 | ⏰ 06:00-22:00 | 📍 남부시장 입구 | 💡 피순대는 2인 이상 추천", cost: 9000, savings: []},
                {name: "🥟분식+디저트", location: "전주시 완산구 남부시장", details: "🥇 옛날피순대: 모듬순대 13,000원 | ⏰ 10:00-21:00 | 📍 청년몰 내 | 💡 순대+간+허파 모듬 인기\n🥈 호떡: 씨앗호떡 3,000원 | 📍 시장 곳곳 | 💡 줄서는 곳이 맛집\n🥉 육전: 5,000원 | 📍 반찬가게들 | 💡 따뜻할 때 드세요\n🍧 팥빙수: 시장표 팥빙수 6,000원 | 📍 2층 청년몰 | 여름 인기", cost: 13000, savings: []},
                {name: "🍱백반+카페", location: "전주시 완산구 남부시장", details: "🥇 전주한정식: 12,000~15,000원 | ⏰ 11:00-21:00 | 📍 한옥마을 주변 | 💡 20여가지 반찬 제공\n🥈 시장백반: 8,000원 | ⏰ 11:00-15:00 | 📍 2층 식당가 | 💡 가성비 최고, 반찬 푸짐\n☕ 청년몰 카페: 아메리카노 3,000원 | 📍 청년몰 2층 | 💡 식후 커피", cost: 11000, savings: []},
                {name: "💡간편식", location: "전주시 완산구 남부시장", details: "🍙 김밥천국: 김밥 3,000원, 라면 4,000원 | ⏰ 24시간 | 📍 시장 입구\n🏪 편의점도시락: 4,000~6,000원 | ⏰ 24시간 | 💡 시간 절약 필요시", cost: 4000, savings: []},
                {name: "☕카페 브런치", location: "전주시 완산구 남부시장", details: "☕ 베테랑분식: 칼국수+김밥 세트 9,000원 | ⏰ 10:00-20:00 | 📍 남부시장 내\n🥐 전주빵카페: 빵+커피 8,000원 | 📍 한옥마을 내 | 💡 가벼운 브런치", cost: 8500, savings: []}
              ],
              details: "🥇추천순위: ①현대옥(콩나물국밥원조,14시마감주의) ②조점례(순대국밥대표) ③청년몰 분식+카페 | 📍위치: 모두 남부시장 내 | ⏰운영: 현대옥(11:00-14:00), 조점례(06:00-22:00), 분식(10:00-20:00)",
              cost: 9000, saving: 0, selectedOptions: [0] },
            
            { id: 5, day: 1, time: "14:00", duration: 120, activity: "한옥마을 쇼핑 & 체험", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "남부시장 쇼핑", location: "전주시 완산구 남부시장", details: "🛍️ 전통시장 체험 | 💰 한지공예품 5,000~30,000원 | 🎁 모주 6,000원, 초코파이 8,000원 | 📍 청년몰 구경 필수 | 💡 현금 준비, 흥정 가능 | 🏛️ 인접: 풍남문(3분), 한옥마을(5분)", cost: 20000, savings: []},
                {name: "전주중앙시장", location: "전주시 덕진구 중앙시장", details: "🛍️ 대형 전통시장 | 💰 한복 50,000~200,000원 | 🎁 전주 특산품 | 📍 한옥마을에서 도보 20분 | 💡 먹거리 다양", cost: 50000, savings: []},
                {name: "한옥마을 기념품샵", location: "전주시 완산구 태조로", details: "🎁 관광 기념품 전문 | 💰 엽서 1,000원, 부채 10,000원 | 📍 태조로 중심 | 💡 포장 서비스, 카드 결제 가능 | 🎨 전주 한지 제품 인기", cost: 15000, savings: []},
                {name: "전통공예 체험", location: "전주시 완산구 태조로", details: "🎨 한지공예체험관 | ⏰ 10:00-18:00 | 💰 체험 10,000~20,000원 | 📍 한지부채, 한지등 만들기 | 🏛️ 인접: 부채문화관, 공예품전시관", cost: 15000, savings: []},
                {name: "한복체험+사진", location: "전주시 완산구 교동", details: "👘 한복대여점 | ⏰ 09:00-20:00 | 💰 2시간 15,000원, 4시간 20,000원 | 📸 전문 사진관 촬영 30,000원~ | 🏛️ 포토스팟: 경기전, 전동성당, 오목대", cost: 20000, savings: []}
              ],
              details: "전통 한지, 부채, 한복 소품 등 구매 가능. 평균 예산 10,000~30,000원. 체험 프로그램 다양",
              cost: 20000, saving: 0, selectedOptions: [0] },
            
            { id: 6, day: 1, time: "16:00", duration: 120, activity: "한옥스테이 체크인 & 휴식", type: "hotel", module: "🔵숙박모듈", status: "✅현재선택",
              options: [
                {name: "한옥스테이", location: "전주시 완산구 교동", details: "🏡 전통 온돌방 체험 | 💰 1박 80,000~150,000원 | 📍 학인당, 동락원 추천 | 🍵 다도 체험 포함 | 🛁 개별 욕실 확인 | 💡 조식 포함 여부 확인", cost: 100000, savings: []},
                {name: "전주 시내 호텔", location: "전주시 완산구", details: "🏨 현대식 호텔 | 💰 1박 70,000~120,000원 | 📍 라한호텔, 르윈호텔 | 🍳 조식 뷔페 포함 | 🚗 주차 무료 | 💡 한옥마을 셔틀 운행", cost: 95000, savings: []},
                {name: "게스트하우스", location: "전주시 완산구 교동", details: "🏠 저렴한 숙박 | 💰 1박 30,000~50,000원 | 📍 한옥마을 내 다수 | 👥 다인실/개인실 선택 | 🍳 공용 주방 이용 가능 | 💡 젊은 여행자 선호", cost: 40000, savings: []},
                {name: "한옥호텔", location: "전주시 완산구 교동", details: "🏯 왕의지밀, 한옥고택 | 💰 1박 150,000~300,000원 | 📍 고급 한옥 숙소 | 🍽️ 조식 한정식 제공 | 🛁 개별 욕실, 스파 | 💡 특별한 날 추천", cost: 200000, savings: []}
              ],
              details: "한옥스테이 1박 80,000~120,000원. 전통 온돌 체험 가능. 한옥마을 내 위치로 야경 감상 좋음",
              cost: 100000, saving: 0, selectedOptions: [0] },
            
            { id: 7, day: 1, time: "18:00", duration: 90, activity: "🍽️ 전주 저녁 한정식", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🍣전통한정식", location: "전주시 완산구 한옥마을", details: "🥇 한국집: 비빔밥+한정식 18,000원 | ⏰ 11:30-21:00 | 📍 한옥마을 내 | 💡 예약 필수, 전주비빔밥 원조 | ⭐ 30여가지 반찬\n🥈 호남각: 고급한정식 25,000원 | ⏰ 11:30-21:30 | 📍 경기전 옆 | 💡 특별한 날 추천 | 🍷 전통주 페어링 가능\n🥉 양반가: 가성비한정식 15,000원 | ⏰ 11:00-21:00 | 📍 전동성당 근처 | 💡 단체 환영", cost: 18000, savings: [{name: "전북투어패스", amount: 2700}]},
                {name: "🍜현대식당", location: "전주시 완산구 중앙시장", details: "🥇 삼백집: 콩나물국밥+한정식 12,000원 | ⏰ 11:00-22:00 | 📍 중앙시장 근처 | 💡 푸짐한 반찬, 현지인 맛집\n🥈 가맥집: 막걸리+안주세트 15,000원 | ⏰ 17:00-24:00 | 📍 삼천동 | 💡 전 종류 다양", cost: 12000, savings: []},
                {name: "🍱간편식사", location: "전주시 완산구", details: "🍜 한옥마을 분식: 8,000~12,000원 | ⏰ 10:00-21:00 | 📍 곳곳에 위치\n🏨 호텔 룸서비스: 15,000~25,000원 | ⏰ 24시간 | 💡 편안한 식사", cost: 10000, savings: []},
                {name: "☕디저트카페", location: "전주시 완산구 교동", details: "🍰 한옥카페 교동: 수제케이크 6,000원, 전통차 5,000원 | ⏰ 10:00-22:00 | 📍 경기전 근처\n🧁 카페봄: 마카롱 3,000원, 커피 4,500원 | 📍 전동성당 앞 | 💡 인스타 명소", cost: 11000, savings: []},
                {name: "💡스킵옵션", location: "전주시 완산구", details: "🍻 막걸리골목에서 안주로 저녁 대체 | 💰 비용 절약 | 💡 다음 일정과 연계", cost: 0, savings: []}
              ],
              details: "🥇추천순위: ①한국집(전주비빔밥원조,예약필수) ②호남각(고급한정식,특별한날) ③삼백집(가성비좋음,콩나물국밥유명) | 📍위치: 한국집/호남각(한옥마을), 삼백집(전주시내) | ⏰운영: 한정식집(11:30-21:00), 일반식당(11:00-22:00) | 💰전북투어패스 할인혜택: 한정식집 15% 할인",
              cost: 18000, saving: 2700, selectedOptions: [0] },
            
            { id: 8, day: 1, time: "20:00", duration: 120, activity: "🍻 전주 막걸리골목", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🍺전통막걸리집", location: "전주시 완산구 삼천동", details: "🥇 학선루: 막걸리+모듬전 15,000원 | ⏰ 17:00-24:00 | 📍 삼천동 막걸리골목 | 💡 100년 전통, 분위기 최고 | 🎭 전통 공연 有\n🥈 삼백집: 막걸리+빈대떡 12,000원 | ⏰ 17:00-02:00 | 📍 막걸리골목 중심 | 💡 빈대떡 바삭함이 일품\n🥉 가맥: 막걸리+안주 10,000원 | ⏰ 17:00-03:00 | 📍 젊은층 핫플 | 💡 가성비 최고", cost: 15000, savings: [{name: "전북투어패스", amount: 3000}]},
                {name: "🥘안주류", location: "전주시 완산구 삼천동", details: "🥞 빈대떡: 8,000원 | 💡 막걸리 필수 안주\n🥬 파전: 7,000원 | 💡 비오는 날 인기\n🥩 수육: 15,000원 | 💡 2-3인 적당\n🌰 도토리묵: 6,000원 | 💡 새콤달콤 양념", cost: 9000, savings: []},
                {name: "🍻현대주점", location: "전주시 완산구 전주천변", details: "🏙️ 전주천변 루프탑바: 맥주 7,000원, 안주 15,000~25,000원 | ⏰ 18:00-02:00 | 📍 전주천 야경 뷰\n☕ 감성카페바: 와인 8,000원, 칵테일 12,000원 | ⏰ 14:00-24:00 | 📍 한옥마을 내", cost: 20000, savings: []},
                {name: "☕야간카페", location: "전주시 완산구", details: "🌙 전주야행카페: 수제맥주 7,000원 | ⏰ 18:00-02:00 | 📍 한옥마을 야경\n☕ 24시카페: 커피 4,000원, 디저트 6,000원 | 📍 객사 근처 | 💡 늦은 시간 이용 가능", cost: 10000, savings: []},
                {name: "💡무알코올", location: "전주시 완산구 한옥마을", details: "🍵 전통찻집: 대추차 5,000원, 오미자차 6,000원 | ⏰ 10:00-22:00 | 📍 한옥마을 곳곳\n☕ 카페: 아메리카노 4,000원, 디저트 6,000원 | ⏰ 09:00-23:00 | 💡 한옥 개조 카페 추천", cost: 10000, savings: []}
              ],
              details: "🥇추천순위: ①학선루(전주3대막걸리집,분위기최고) ②삼백집(전통맛,빈대떡유명) ③가맥(가성비좋음,젊은층선호) | 📍위치: 모두 한옥마을 막걸리골목 | ⏰운영: 막걸리집(17:00-24:00), 카페(10:00-22:00) | 💰전북투어패스 할인혜택: 20% 할인",
              cost: 15000, saving: 3000, selectedOptions: [0] },

            // Day 2
            { id: 9, day: 2, time: "08:00", duration: 60, activity: "🍽️ 전주 아침식사", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🍚호텔조식", location: "전주시 완산구", details: "🏨 호텔뷔페: 15,000~20,000원 | ⏰ 06:30-09:30 | 💡 한식/양식 선택 가능 | 🍳 라이브 스테이션\n🏠 룸서비스: 10,000~15,000원 | ⏰ 07:00-10:00 | 💡 편안한 식사", cost: 15000, savings: []},
                {name: "🍜전통아침", location: "전주시 완산구", details: "🥇 콩나물국밥: 8,000원 | ⏰ 06:00-10:00 | 📍 현대옥, 왱이집 | 💡 해장에 최고\n🥈 순두부찌개: 7,000원 | ⏰ 07:00-11:00 | 📍 한옥마을 주변\n🥉 김치찌개: 6,000원 | ⏰ 24시간 | 📍 김밥천국", cost: 8000, savings: []},
                {name: "🥞간단식사", location: "전주시 완산구", details: "🍞 토스트: 3,000원 | 📍 이삭토스트 | ⏰ 07:00-22:00\n🥪 샌드위치: 5,000원 | 📍 서브웨이 | ⏰ 08:00-23:00\n🥣 죽: 6,000원 | 📍 본죽 | ⏰ 07:00-22:00", cost: 4500, savings: []},
                {name: "☕모닝카페", location: "전주시 완산구 한옥마을", details: "☕ 카페 봄봄: 브런치세트 12,000원 | ⏰ 08:00-22:00 | 📍 한옥마을 내\n🥐 베이커리카페: 빵+커피 8,000원 | 📍 객사 근처 | 💡 갓 구운 빵", cost: 10000, savings: []},
                {name: "💡스킵옵션", location: "-", details: "⏰ 시간 절약하여 바로 출발 | 🍪 간식으로 대체 | 💡 이동 중 휴게소 이용", cost: 0, savings: []}
              ],
              details: "🥇추천순위: ①호텔조식(편리하고 든든함) ②콩나물국밥(전주대표아침메뉴) ③모닝카페(여유로운 브런치) | 📍위치: 호텔조식(숙소), 전통아침(전주시내) | ⏰운영: 호텔조식(06:30-09:30), 전통식당(06:00-10:00)",
              cost: 8000, saving: 0, selectedOptions: [1] },
            
            { id: 10, day: 2, time: "09:30", duration: 30, activity: "체크아웃 & 전주 떠나기", type: "hotel", module: "🔵체크아웃모듈", status: "✅현재선택",
              options: [
                {name: "짐 호텔 보관", location: "전주시 완산구", details: "🧳 프론트 무료 보관 | ⏰ 당일 18시까지 | 💡 가벼운 관광 가능", cost: 0, savings: []},
                {name: "직접 체크아웃", location: "전주시 완산구", details: "🚗 차량에 짐 보관 | ⏰ 11시 전 체크아웃 | 💡 주차요금 확인", cost: 0, savings: []},
                {name: "연장 체크아웃", location: "전주시 완산구", details: "⏰ 12시까지 연장 | 💰 10,000~20,000원 추가 | 💡 사전 요청 필수", cost: 15000, savings: []}
              ],
              details: "체크아웃 시간 준수, 짐 보관 서비스 이용 시 무료",
              cost: 0, saving: 0, selectedOptions: [1] },
            
            { id: 11, day: 2, time: "11:00", duration: 90, activity: "🍜 전주 점심맛집", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🍲순대국밥", location: "전주시 완산구 남부시장", details: "🥇 조점례남문피순대: 순대국밥 9,000원, 피순대(소) 13,000원 | ⏰ 06:00-22:00 | 📍 남부시장 안 | 💡 피순대는 겉은 바삭, 속은 쫄깃 | ⭐ 전주 3대 순대 맛집", cost: 9000, savings: []},
                {name: "🍜콩나물국밥", location: "전주시 완산구", details: "🥇 왱이집: 8,000원 | ⏰ 05:30-21:00 | 📍 중앙시장 | 💡 맵기 조절 가능, 수란 추가 1,000원\n🥈 현대옥: 8,000원 | ⏰ 05:30-15:00 | 📍 남부시장 | 💡 14시 마감 주의\n🥉 삼백집: 8,000원 | ⏰ 24시간 | 📍 효자동 | 💡 담백한 맛", cost: 8000, savings: []},
                {name: "🍣한정식", location: "전주시 완산구 한옥마을", details: "🥇 호남각: 점심특선 15,000원 | ⏰ 11:30-14:00 | 📍 한옥마을 | 💡 20가지 반찬\n🥈 한국집: 돌솥비빔밥 12,000원 | ⏰ 11:00-21:00 | 📍 경기전 앞 | 💡 전주비빔밥 원조\n🥉 양반가: 백반정식 10,000원 | ⏰ 11:00-15:00 | 📍 전동성당 근처", cost: 12500, savings: []},
                {name: "🍚비빔밥", location: "전주시 완산구 한옥마을", details: "🥇 전라도음식이야기: 전주비빔밥 10,000원 | ⏰ 10:00-21:00 | 📍 한옥마을 | 💡 육회비빔밥 +3,000원\n🥈 고궁: 돌솥비빔밥 12,000원 | ⏰ 10:00-22:00 | 📍 객사 근처 | 💡 프랜차이즈지만 전주가 원조", cost: 11000, savings: []},
                {name: "☕브런치카페", location: "전주시 완산구 한옥마을", details: "☕ 한옥마을 브런치: 파스타 12,000원, 샐러드 10,000원 | ⏰ 10:00-21:00 | 📍 한옥마을 내\n🥐 수제버거: 수제버거 9,000원 | 📍 객사 근처 | 💡 젊은층 인기", cost: 10500, savings: []}
              ],
              details: "🥇추천순위: ①조점례남문피순대(전주대표맛,남부시장안) ②왱이집(콩나물국밥맛집,맵기조절가능) ③호남각(전주한정식대표) | 📍위치: 조점례(남부시장), 왱이집/현대옥/삼백집(전주시내), 한정식집들(한옥마을근처) | ⏰운영: 조점례(6:00-22:00), 콩나물국밥집(11:00-21:00), 한정식(11:30-21:00)",
              cost: 9000, saving: 0, selectedOptions: [0] },
            
            { id: 12, day: 2, time: "13:00", duration: 60, activity: "전주 → 군산 이동", type: "transport", module: "🟣이동모듈", status: "✅현재선택",
              options: [
                {name: "자가용 직행", location: "전주시 → 군산시", details: "🚗 전주→군산 | ⏰ 1시간 | 💰 유료도로비 3,000원 + 주유비 10,000원 | 📍 21번 국도 이용 | 🅿️ 군산 공영주차장", cost: 13000, savings: []},
                {name: "시외버스", location: "전주시 → 군산시", details: "🚌 전주시외버스터미널→군산터미널 | ⏰ 1시간 | 💰 5,400원 | 📍 20분 간격 운행 | 💡 버스타고 앱 예약", cost: 5400, savings: []},
                {name: "택시", location: "전주시 → 군산시", details: "🚕 전주→군산 | ⏰ 50분 | 💰 약 50,000원 | 💡 4인 이용시 가성비 | 📞 콜택시 이용 추천", cost: 50000, savings: []}
              ],
              details: "자가용: 1시간, 시외버스: 1시간(5,400원), 택시: 50,000원",
              cost: 5400, saving: 0, selectedOptions: [1] },
            
            { id: 13, day: 2, time: "14:30", duration: 90, activity: "🎬신흥동일본식가옥(히로시가옥) & 근대문화탐방", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "🎬신흥동일본식가옥", location: "군산시 신흥동", details: "🏯 영화 '타짜' 촬영지 | ⏰ 09:00-17:00 | 💰 성인 1,500원→전북투어패스 무료 | 📍 일제강점기 부호 저택 | 📸 다다미방, 일본정원 | 🎬 영화 속 그 장면 재현 가능 | 🏛️ 인접: 동국사(도보 5분), 초원사진관(3분)", cost: 0, savings: [{name: "전북투어패스", amount: 1500}]},
                {name: "🏛️경암동철길마을", location: "군산시 경암동", details: "🚂 폐철길 따라 조성된 마을 | ⏰ 상시개방 | 💰 무료 | 📍 2.5km 철길 | 📸 철길 위 인생샷 | 🎨 벽화마을, 추억의 간식 | 🏛️ 인접: 경암동 철길마을역(시작점), 팔마광장(도보 10분)", cost: 0, savings: []},
                {name: "🏛️근대역사박물관", location: "군산시 해망로", details: "🏛️ 군산 근대사 전시 | ⏰ 09:00-18:00 | 💰 성인 3,000원→전북투어패스 무료 | 📍 3층 전망대 | 🎓 근대문화 체험 | 💡 통합권 구매시 할인 | 🏛️ 인접: 군산세관(바로 옆), 근대미술관(도보 2분), 장미갤러리(3분)", cost: 0, savings: [{name: "전북투어패스", amount: 3000}]},
                {name: "🏛️군산세관", location: "군산시 해망로", details: "🏛️ 현존 최고 세관건물 | ⏰ 09:00-18:00 | 💰 성인 1,000원→전북투어패스 무료 | 📍 1908년 건축 | 📸 서양식 건축미 | 🎓 세관 역사 전시 | 🏛️ 인접: 근대역사박물관(바로 옆), 구 군산은행(2분)", cost: 0, savings: [{name: "전북투어패스", amount: 1000}]},
                {name: "🌊진포해양공원", location: "군산시 내항", details: "⚓ 해군 함정 전시 | ⏰ 09:00-18:00 | 💰 무료 | 📍 위봉함 등 13척 | 📸 함정 내부 관람 | 👨‍👩‍👧‍👦 어린이 인기 | 🏛️ 인접: 군산내항(도보 5분), 짬뽕거리(10분)", cost: 0, savings: []}
              ],
              details: "신흥동일본식가옥(히로시가옥) 타짜 촬영지로 유명, 일본강점기 건축양식 체험 가능. 🔵전북투어패스 무료 입장! 💰절약 금액: 히로시가옥 성인 1,500원→무료. 인접 관광지가 많아 도보로 연계 관광 가능",
              cost: 0, saving: 1500, selectedOptions: [0] },
            
            { id: 14, day: 2, time: "16:00", duration: 90, activity: "군산 근대문화유산거리 투어", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "동국사+근대거리", location: "군산시 동국사길", details: "🏛️ 일제강점기 일본식 사찰 | ⏰ 09:00-18:00 | 💰 무료 | 📍 국내 유일 일본식 사찰 | 📸 대웅전, 종각 | 🙏 참배 체험 가능 | 🏛️ 인접: 히로시가옥(5분), 이영춘가옥(3분), 신흥동 일본식가옥거리", cost: 0, savings: []},
                {name: "구 군산세관+은행", location: "군산시 해망로", details: "🏛️ 1908년 건축 | ⏰ 09:00-18:00 | 💰 1,000원→전북투어패스 무료 | 📍 서양식 단층건물 | 📸 근대건축 대표 | 🎓 세관 역사 전시 | 🏛️ 인접: 구 조선은행(2분), 구 일본18은행(3분)", cost: 0, savings: [{name: "전북투어패스", amount: 1000}]},
                {name: "장미갤러리+미술관", location: "군산시 장미동", details: "🎨 근대미술 전시 | ⏰ 10:00-18:00 | 💰 2,000원 | 📍 구 일본18은행 | 📸 아르데코 건축 | 🎨 기획전시 수시 변경 | 🏛️ 인접: 근대미술관(1분), 근대역사박물관(3분)", cost: 2000, savings: []},
                {name: "근대미술관", location: "군산시 장미동", details: "🎨 옛 일본18은행 건물 | ⏰ 09:00-18:00 | 💰 무료 | 📍 장미동 | 📸 금고 전시실 | 🎨 근대 미술품 전시 | 🏛️ 인접: 장미갤러리(1분), 군산세관(3분)", cost: 0, savings: []},
                {name: "📸김치사진관", location: "군산시 월명동", details: "📸 추억의 사진관 | ⏰ 10:00-18:00 | 💰 사진촬영 10,000원~ | 📍 월명동 | 🎬 복고풍 컨셉 사진 | 📷 의상+소품 대여 포함 | 💡 예약 추천 | 🏛️ 인접: 월명공원(5분), 초원사진관(10분)", cost: 10000, savings: []},
                {name: "초원사진관", location: "군산시 신흥동", details: "📸 8월의 크리스마스 촬영지 | ⏰ 09:00-18:00 | 💰 무료 | 📍 신흥동 | 📸 영화 속 그대로 보존 | 🎬 포토존 인기 | 🏛️ 인접: 히로시가옥(3분), 동국사(5분)", cost: 0, savings: []}
              ],
              details: "전북투어패스로 대부분 무료입장. 근대역사 체험 코스. 김치사진관에서 복고풍 사진 촬영 추천. 모든 관광지가 도보 10분 이내로 효율적 동선 가능",
              cost: 0, saving: 3000, selectedOptions: [0, 4] },
            
            { id: 15, day: 2, time: "17:30", duration: 90, activity: "🚢🌊 선유도 방문", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "🏖️선유도해수욕장", location: "군산시 옥도면 선유도", details: "🏖️ 명사십리 해변 | ⏰ 상시개방 | 💰 무료 | 📍 고군산군도 대표 해변 | 🏊‍♀️ 여름 해수욕 | 🌅 서해 낙조 명소 | 🏛️ 인접: 망주봉(도보 20분), 선유대교(5분)", cost: 0, savings: []},
                {name: "🦞선유도활어회센터", location: "군산시 옥도면 선유도", details: "🦞 싱싱한 활어회 | ⏰ 10:00-22:00 | 💰 2인 50,000원~ | 📍 선착장 인근 | 🦑 제철 해산물 | 💡 공동구매 가능 | 🏛️ 인접: 선유도항(1분), 해수욕장(5분)", cost: 50000, savings: []},
                {name: "🚢선유도유람선", location: "군산시 옥도면 선유도", details: "🚢 섬 일주 관광 | ⏰ 10:00-17:00(1시간 간격) | 💰 성인 15,000원 | 📍 선유도항 출발 | 🌊 고군산군도 전경 | 📸 갈매기 먹이주기 | 🏛️ 인접: 무녀도, 장자도 경유", cost: 15000, savings: []},
                {name: "🌅망주봉일몰", location: "군산시 옥도면 선유도", details: "🌄 선유8경 중 1경 | ⏰ 상시개방 | 💰 무료 | 📍 도보 20분 | 📸 일몰 명소 | 💡 일몰 30분 전 도착 | 🏛️ 인접: 망주봉 전망대, 선유봉(15분)", cost: 0, savings: []},
                {name: "🌉선유대교산책", location: "군산시 옥도면 선유도", details: "🌉 선유1교, 2교 연결 | ⏰ 상시개방 | 💰 무료 | 📍 자전거 대여 10,000원 | 📸 다리 위 포토존 | 🚴‍♀️ 자전거 투어 인기 | 🏛️ 인접: 무녀도(선유2교 건너편), 장자도(선유1교)", cost: 0, savings: []}
              ],
              details: "선유도 관광. 일몰시간 맞춰 방문하면 환상적인 뷰. 날씨 확인 필수. 인접 섬들도 다리로 연결되어 도보/자전거 관광 가능",
              cost: 0, saving: 0, selectedOptions: [0] },
            
            { id: 16, day: 2, time: "19:00", duration: 60, activity: "선유도 일몰 감상", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "망주봉 일몰", location: "군산시 옥도면 선유도", details: "🌅 선유8경 최고 절경 | ⏰ 일몰 30분 전 도착 | 💰 무료 | 📍 정상까지 20분 | 📸 서해 낙조 파노라마 | 💡 삼각대 준비", cost: 0, savings: []},
                {name: "해변 산책", location: "군산시 옥도면 선유도", details: "🏖️ 명사십리 해변 | ⏰ 상시개방 | 💰 무료 | 📍 모래사장 2km | 🚶‍♀️ 맨발 산책 | 🌊 파도소리 힐링", cost: 0, savings: []},
                {name: "카페에서 여유", location: "군산시 옥도면 선유도", details: "☕ 선유도 카페 | ⏰ 10:00-21:00 | 💰 커피 5,000원 | 📍 해변가 카페 | 🌅 선셋뷰 테라스 | 📸 감성 사진", cost: 5000, savings: []},
                {name: "선상에서 일몰", location: "군산시 옥도면 선유도", details: "🚢 유람선 일몰 크루즈 | ⏰ 18:00 출발 | 💰 20,000원 | 📍 1시간 코스 | 🌅 바다 위 일몰 | 📸 특별한 경험", cost: 20000, savings: []}
              ],
              details: "선유도 대표 일몰 명소. 무료 관람. 망주봉이 최고 포인트지만 체력 고려해서 선택",
              cost: 0, saving: 0, selectedOptions: [0] },
            
            { id: 17, day: 2, time: "20:00", duration: 90, activity: "🍽️ 군산 저녁식사", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🔥매운짬뽕", location: "군산시 미원동", details: "🥇 지린성: 고추짜장 11,000원, 고추짬뽕 11,000원 | ⏰ 09:30-16:00(브레이크타임 15:00-16:00) | 📍 미원로 87 | 💡 웨이팅 30분 예상, 화요일 휴무 | 🌶️ 매운맛 단계 선택 가능 | ⭐ 백종원의 3대천왕 출연", cost: 11000, savings: []},
                {name: "🍜전통짬뽕", location: "군산시 짬뽕거리", details: "🥇 복성루: 짬뽕 10,000원, 볶음밥 10,000원 | ⏰ 10:30-20:30 | 📍 짬뽕거리 | 💡 군산 3대 짬뽕, 해물 듬뿍 | 🦑 오징어, 새우 신선\n🥈 빈해원: 해물짬뽕 12,000원 | ⏰ 10:00-21:00 | 📍 중앙로 | 💡 국물이 진하고 시원함", cost: 10000, savings: []},
                {name: "🦀꽃게요리", location: "군산시 해망동", details: "🥇 궁전꽃게장: 간장게장 35,000원/kg | ⏰ 11:00-21:00 | 📍 해망동 | 💡 신선한 암게만 사용, 양념이 일품 | 🍚 공기밥 무한리필 | ⭐ 군산 대표 꽃게장 맛집\n🥈 대가꽃게장: 간장게장 30,000원/kg | ⏰ 10:30-21:30 | 📍 해망로 | 💡 암게만 사용, 살이 꽉 참\n🥉 계곡가든: 꽃게탕(2인) 62,000원 | ⏰ 11:00-21:00 | 📍 개정면 | 💡 꽃게찜도 인기", cost: 35000, savings: []},
                {name: "☕디저트카페", location: "군산시 월명동", details: "☕ 군산 카페거리: 수제케이크 6,000원, 커피 4,500원 | ⏰ 10:00-22:00 | 📍 월명동\n🍰 초원사진관 카페: 팥빙수 8,000원 | 📍 신흥동 | 💡 영화 촬영지 카페", cost: 10500, savings: []},
                {name: "💡간편식", location: "군산시", details: "🏪 편의점도시락: 4,000~6,000원 | ⏰ 24시간 | 💡 시간 절약\n🏨 호텔 룸서비스: 15,000~25,000원 | ⏰ 룸서비스 시간 확인", cost: 5000, savings: []}
              ],
              details: "🥇추천순위: ①궁전꽃게장(군산대표맛집,신선한암게) ②지린성(웨이팅30분,고추맛특화) ③복성루(군산3대짬뽕,전통맛) | 📍위치: 궁전꽃게장(해망동), 지린성(미원로87), 복성루(짬뽕거리) | ⏰운영: 궁전꽃게장(11:00-21:00), 지린성(9:30-16:00,화요일휴무)",
              cost: 11000, saving: 0, selectedOptions: [0] },
            
            { id: 18, day: 2, time: "22:00", duration: 480, activity: "군산 숙박", type: "hotel", module: "🔵숙박모듈", status: "✅현재선택",
              options: [
                {name: "짬뽕거리 호텔", location: "군산시 짬뽕거리", details: "🏨 베스트웨스턴군산호텔 | 💰 80,000~120,000원 | 📍 짬뽕거리 도보 5분 | 🍳 조식 포함 | 🚗 무료주차 | 💡 군산 시내 중심", cost: 100000, savings: []},
                {name: "군산 시내 모텔", location: "군산시 나운동", details: "🏩 깨끗한 모텔 | 💰 50,000~70,000원 | 📍 터미널 주변 | 🚗 주차 가능 | 💡 가성비 숙박", cost: 60000, savings: []},
                {name: "리조트/펜션", location: "군산시 옥도면 선유도", details: "🏖️ 선유도 펜션 | 💰 100,000~150,000원 | 📍 바다 전망 | 🍖 바베큐 가능 | 👨‍👩‍👧‍👦 가족 단위 추천", cost: 125000, savings: []},
                {name: "게스트하우스", location: "군산시 월명동", details: "🏠 군산 게스트하우스 | 💰 30,000~50,000원 | 📍 근대문화거리 | 👥 다인실/개인실 | 🍳 공용주방 | 💡 배낭여행자 선호", cost: 40000, savings: []}
              ],
              details: "짬뽕거리 근처 숙박 추천. 1박 60,000~80,000원. 다음날 이성당 방문 편리한 위치",
              cost: 70000, saving: 0, selectedOptions: [1] },

            // Day 3
            { id: 19, day: 3, time: "08:00", duration: 60, activity: "🍽️ 군산 아침식사", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🍚호텔조식", location: "군산시", details: "🏨 호텔뷔페: 15,000~20,000원 | ⏰ 06:30-09:30 | 💡 한식/양식 뷔페 | 🥐 베이커리 포함\n🏨 룸서비스: 10,000~15,000원 | ⏰ 07:00-10:00 | 💡 편안한 식사", cost: 17500, savings: []},
                {name: "🍜전통아침", location: "군산시", details: "🥇 군산짬뽕: 8,000원 | ⏰ 09:00-20:00 | 📍 복성루, 빈해원 | 💡 아침 짬뽕 해장\n🥈 콩나물국밥: 7,000원 | ⏰ 06:00-22:00 | 📍 24시 콩나물국밥\n🥉 미역국: 9,000원 | ⏰ 07:00-20:00 | 📍 생일상 미역국", cost: 8000, savings: []},
                {name: "🥞간단식사", location: "군산시", details: "🍞 토스트: 3,000원 | 📍 이삭토스트 | ⏰ 07:00-22:00\n🥪 샌드위치: 5,000원 | 📍 서브웨이 | ⏰ 08:00-23:00\n🍙 김밥: 3,500원 | 📍 김밥천국 | ⏰ 24시간", cost: 3800, savings: []},
                {name: "☕모닝카페", location: "군산시 중앙로", details: "☕ 이성당 카페: 빵+커피 8,000원 | ⏰ 08:00-22:00 | 📍 이성당 본점\n🥐 군산 베이커리: 빵+음료 7,000원 | 📍 시내 곳곳 | 💡 갓 구운 빵", cost: 7500, savings: []},
                {name: "💡스킵옵션", location: "-", details: "⏰ 바로 출발하여 시간 절약 | 🍪 간식으로 대체 | 💡 이성당에서 빵 구매 예정", cost: 0, savings: []}
              ],
              details: "🥇추천순위: ①호텔조식(편리하고 든든함) ②군산짬뽕(현지대표맛) ③이성당카페(빵+커피) | 📍위치: 호텔조식(짬뽕거리), 전통식당(군산시내) | ⏰운영: 호텔조식(06:30-09:30), 전통식당(06:00-10:00)",
              cost: 7000, saving: 0, selectedOptions: [1] },
            
            { id: 20, day: 3, time: "09:30", duration: 30, activity: "체크아웃 & 짐 정리", type: "hotel", module: "🔵체크아웃모듈", status: "✅현재선택",
              options: [
                {name: "정시 체크아웃", location: "군산시", details: "⏰ 11시 정시 체크아웃 | 🧳 짐 정리 확인 | 💡 미니바 정산", cost: 0, savings: []},
                {name: "연장 체크아웃", location: "군산시", details: "⏰ 12시까지 연장 | 💰 10,000~20,000원 추가 | 💡 프론트 사전 문의", cost: 15000, savings: []},
                {name: "짐 호텔 보관", location: "군산시", details: "🧳 프론트 보관 | ⏰ 당일 18시까지 | 💰 무료 | 💡 관광 후 수령", cost: 0, savings: []},
                {name: "차량 이동", location: "군산시", details: "🚗 체크아웃 후 차량 보관 | 🅿️ 주차장 이동 | 💡 주차권 확인", cost: 0, savings: []}
              ],
              details: "체크아웃 후 짐 차량 보관 또는 호텔 보관 서비스 이용",
              cost: 0, saving: 0, selectedOptions: [0] },
            
            { id: 21, day: 3, time: "10:30", duration: 60, activity: "이성당 명물빵 구매 & 카페", type: "special", module: "🟠명물모듈", status: "✅현재선택",
              options: [
                {name: "이성당 본점", location: "군산시 중앙로", details: "🥐 1945년 창업 대한민국 최초 빵집 | ⏰ 08:00-22:00 | 📍 중앙로 | 🥖 야채빵 2,500원, 단팥빵 3,000원 | 💡 오전 일찍 가야 빵 종류 다양 | ⭐ 줄서기 필수 | 🏛️ 인접: 이성당 신관(바로 옆), 근대역사박물관(도보 10분)", cost: 8000, savings: []},
                {name: "이성당 신관카페", location: "군산시 중앙로", details: "☕ 베이커리 카페 | ⏰ 09:00-22:00 | 📍 본점 옆 | ☕ 커피 5,000원 + 빵 | 🪑 2층 좌석 여유 | 📸 인테리어 포토존 | 🏛️ 인접: 이성당 본점(바로 옆)", cost: 10000, savings: []},
                {name: "PNB풍년제과", location: "군산시 월명로", details: "🥖 1951년 창업 | ⏰ 08:00-21:00 | 📍 월명로 | 🥐 초코파이 원조 | 💰 찹쌀도너츠 2,000원 | 💡 현지인 추천 | 🏛️ 인접: 월명공원(5분), 월명체육관(3분)", cost: 5000, savings: []},
                {name: "군산 특산품샵", location: "군산시", details: "🎁 군산 특산품 | ⏰ 09:00-20:00 | 📍 시내 곳곳 | 🦑 박대 구이, 젓갈 | 💰 선물세트 20,000원~ | 📦 택배 가능", cost: 20000, savings: []},
                {name: "☕군산카페거리", location: "군산시 월명동", details: "☕ 감성카페들 | ⏰ 10:00-22:00 | 📍 월명동 일대 | 💰 커피 4,500원, 디저트 6,000원 | 📸 인스타 명소 | 🏛️ 인접: 월명공원, 근대건축물들", cost: 10500, savings: []}
              ],
              details: "이성당 대표 단팥빵 3,000원, 카페에서 커피 5,000원 추가. 군산 대표 명물. 인근에 카페거리도 있어 선택지 다양",
              cost: 8000, saving: 0, selectedOptions: [0] },
            
            { id: 22, day: 3, time: "12:00", duration: 90, activity: "🍜 군산 점심식사", type: "food", module: "🟢식사모듈", status: "✅현재선택",
              options: [
                {name: "🍜짬뽕대표", location: "군산시 짬뽕거리", details: "🥇 복성루: 전통짬뽕 10,000원 | ⏰ 10:30-20:30 | 📍 짬뽕거리 | 💡 군산 3대 짬뽕, 국물이 시원 | 🦑 해물 신선\n🥈 빈해원: 해물짬뽕 12,000원 | ⏰ 10:00-21:00 | 💡 국물 진함\n🥉 지린성: 고추짬뽕 11,000원 | ⏰ 09:30-16:00 | 💡 매운맛, 웨이팅", cost: 10000, savings: []},
                {name: "🍞빵카페", location: "군산시 중앙로", details: "☕ 이성당 신관: 빵+커피세트 8,000원 | ⏰ 09:00-22:00 | 📍 이성당 본점 옆 | 💡 브런치 메뉴\n🥐 PNB풍년제과: 빵+음료 6,000원 | ⏰ 08:00-21:00 | 💡 찹쌀도너츠 인기", cost: 7000, savings: []},
                {name: "🍱한식", location: "군산시 나운동", details: "🥘 군산회관: 아구찜 25,000원(2인) | ⏰ 11:00-21:00 | 📍 나운동 | 💡 매콤한 양념\n🍚 산성식당: 백반 8,000원 | ⏰ 11:00-20:00 | 📍 월명동 | 💡 가정식 백반", cost: 12500, savings: []},
                {name: "☕브런치카페", location: "군산시 월명동", details: "☕ 군산 브런치: 파스타 12,000원, 샐러드 10,000원 | ⏰ 10:00-21:00 | 📍 월명동\n🥪 수제버거: 수제버거 9,000원 | 📍 나운동 | 💡 젊은층 인기", cost: 10500, savings: []},
                {name: "💡간편식", location: "군산시", details: "🍱 도시락: 5,000~8,000원 | 📍 편의점 | 💡 이동 중 식사\n🍜 컵라면: 2,000~3,000원 | 📍 휴게소 | 💡 시간 절약", cost: 6500, savings: []}
              ],
              details: "🥇추천순위: ①복성루(군산3대짬뽕,전통맛) ②지린성(고추맛특화,웨이팅예상) ③이성당신관카페(빵+커피콤보,여유로운시간) | 📍위치: 짬뽕집(짬뽕거리), 이성당(미원로), 현지식당(군산시내) | ⏰운영: 짬뽕집(10:00-16:00), 카페(09:00-22:00), 현지식당(11:00-21:00)",
              cost: 10000, saving: 0, selectedOptions: [0] },
            
            { id: 23, day: 3, time: "13:30", duration: 90, activity: "🏛️📸 군산 마지막 관광", type: "tour", module: "🟡관광모듈", status: "✅현재선택",
              options: [
                {name: "군산내항", location: "군산시 내항", details: "🚢 근대산업유산 | ⏰ 상시개방 | 💰 무료 | 📍 부잔교, 뜬다리 | 📸 레트로 감성 | ☕ 카페거리 | 🏛️ 인접: 근대역사박물관(5분), 진포해양공원(10분)", cost: 0, savings: []},
                {name: "진포해양테마공원", location: "군산시 내항", details: "⚓ 퇴역 군함 전시 | ⏰ 09:00-18:00 | 💰 무료 | 📍 위봉함 등 13척 | 👨‍👩‍👧‍👦 가족 관광 | 📸 함정 포토존 | 🏛️ 인접: 군산내항(10분), 짬뽕거리(15분)", cost: 0, savings: []},
                {name: "경암동철길마을", location: "군산시 경암동", details: "🚂 추억의 철길 | ⏰ 상시개방 | 💰 무료 | 📍 2.5km 철길 | 📸 인생샷 명소 | 🍡 추억의 간식 | 🏛️ 인접: 팔마광장(10분)", cost: 0, savings: []},
                {name: "근대역사박물관", location: "군산시 해망로", details: "🏛️ 군산 역사 | ⏰ 09:00-18:00 | 💰 3,000원→전북투어패스 무료 | 📍 3층 전망대 | 🎓 역사 체험 | 💡 마지막 정리 | 🏛️ 인접: 군산세관, 근대미술관", cost: 0, savings: [{name: "전북투어패스", amount: 2000}]},
                {name: "월명공원", location: "군산시 월명동", details: "🌳 도심 속 공원 | ⏰ 상시개방 | 💰 무료 | 📍 벚꽃터널(봄) | 🏛️ 수시탑, 진포대첩비 | 🚶‍♀️ 산책로 | 🏛️ 인접: 월명체육관, 카페거리", cost: 0, savings: []}
              ],
              details: "마지막 군산 추억 만들기. 전북투어패스로 무료입장, 2,000원 절약. 인접 관광지 연계로 효율적 관광",
              cost: 0, saving: 2000, selectedOptions: [2] },
            
            { id: 24, day: 3, time: "15:00", duration: 150, activity: "군산 → 수원 출발", type: "transport", module: "🟣이동모듈", status: "✅현재선택",
              options: [
                {name: "자가용 직행", location: "군산시 → 수원시", details: "🚗 군산→수원 | ⏰ 2시간 30분 | 💰 유료도로비 15,000원 + 주유비 25,000원 | 📍 서해안고속도로 | 🚙 휴게소 휴식", cost: 40000, savings: []},
                {name: "고속버스", location: "군산시 → 수원시", details: "🚌 군산→수원 | ⏰ 3시간 | 💰 12,000원 | 📍 2시간 간격 운행 | 🎫 버스타고 앱 예약 | 💺 우등버스 +4,000원", cost: 12000, savings: []},
                {name: "KTX(서대전경유)", location: "군산시 → 수원시", details: "🚄 군산→익산→서대전→수원 | ⏰ 3시간 | 💰 35,000원 | 📍 환승 2회 | 🎫 코레일톡 예약 | 💡 빠르지만 비쌈", cost: 35000, savings: []}
              ],
              details: "자가용: 2시간 30분, 고속버스: 3시간(12,000원), KTX: 3시간(35,000원)",
              cost: 12000, saving: 0, selectedOptions: [1] },
            
            { id: 25, day: 3, time: "17:30", duration: 120, activity: "수원 도착 & 마무리", type: "special", module: "🟠마무리모듈", status: "✅현재선택",
              options: [
                {name: "집에서 휴식", location: "수원시", details: "🏠 여행 피로 회복 | 🛁 온수 목욕 | 📸 사진 정리 | 💡 추억 회상", cost: 0, savings: []},
                {name: "헬스장 운동", location: "수원시", details: "💪 여행 중 못한 운동 | ⏰ 저녁 시간대 | 🏃‍♀️ 유산소 위주 | 💡 가벼운 강도", cost: 0, savings: []},
                {name: "공원 산책", location: "수원시", details: "🚶‍♀️ 가벼운 산책 | 🌳 근처 공원 | 🌅 저녁 산책 | 💡 여행 마무리", cost: 0, savings: []},
                {name: "마트 쇼핑", location: "수원시", details: "🛒 일상 복귀 준비 | 🥬 장보기 | 🍱 간단한 저녁 | 💡 일상으로 전환", cost: 0, savings: []},
                {name: "☕카페 정리", location: "수원시", details: "☕ 동네 카페 | 📸 사진 정리 | 📝 여행 기록 | 💡 추억 정리", cost: 0, savings: []}
              ],
              details: "여행 마무리 후 개인 시간. 비용 없음",
              cost: 0, saving: 0, selectedOptions: [0] },

            // Alternative options (Day 0)
            { id: 26, day: 0, time: "대체", duration: 120, activity: "대체 관광 옵션", type: "tour", module: "🟡대체관광모듈", status: "⭕대체옵션",
              options: [
                {name: "전주동물원", location: "전주시 덕진구", details: "🦁 도심 속 동물원 | ⏰ 09:00-18:00 | 💰 성인 1,500원→전북투어패스 무료 | 📍 덕진구 | 🐘 100여종 동물 | 👨‍👩‍👧‍👦 가족 관광 | 🏛️ 인접: 덕진공원(바로 옆), 전북대(10분)", cost: 0, savings: [{name: "전북투어패스", amount: 1500}]},
                {name: "덕진공원", location: "전주시 덕진구", details: "🌸 연꽃 명소 | ⏰ 상시개방 | 💰 무료 | 📍 덕진호수 | 🚣‍♀️ 오리배 대여 | 🌷 계절별 꽃 축제 | 🏛️ 인접: 전주동물원(바로 옆), 전북대(10분)", cost: 0, savings: []},
                {name: "한지산업지원센터", location: "전주시 덕진구", details: "📜 한지 체험 | ⏰ 09:00-18:00 | 💰 체험 10,000원 | 📍 한지 제작 과정 | 🎨 한지공예 체험 | 💡 예약 필수", cost: 10000, savings: []},
                {name: "전주향교+완판본문화관", location: "전주시 완산구", details: "📚 조선시대 교육기관 | ⏰ 09:00-18:00 | 💰 무료 | 📍 한옥마을 인근 | 🎓 대성전, 명륜당 | 🏛️ 인접: 완판본문화관(5분), 한벽당(10분)", cost: 0, savings: []},
                {name: "자만벽화마을", location: "전주시 완산구", details: "🎨 벽화마을 | ⏰ 상시개방 | 💰 무료 | 📍 오목대 인근 | 📸 포토존 다수 | 🏛️ 인접: 오목대(5분), 이목대(8분)", cost: 0, savings: []},
                {name: "근대미술관", location: "군산시 장미동", details: "🎨 근대 미술 전시 | ⏰ 09:00-18:00 | 💰 무료 | 📍 구 일본18은행 | 🏛️ 근대건축물 | 📸 금고실 포토존", cost: 0, savings: []},
                {name: "채만식문학관", location: "군산시 금강변", details: "📚 문학관 | ⏰ 09:00-18:00 | 💰 1,000원→전북투어패스 무료 | 📍 금강변 | 📖 탁류 작가 | 🌊 금강 전망", cost: 0, savings: [{name: "전북투어패스", amount: 1000}]},
                {name: "은파호수공원", location: "군산시 나운동", details: "🏞️ 도심 호수공원 | ⏰ 상시개방 | 💰 무료 | 📍 물빛다리 | 🚶‍♀️ 산책로 | 🎵 음악분수", cost: 0, savings: []},
                {name: "새만금방조제", location: "군산시 새만금", details: "🌊 세계 최장 방조제 | ⏰ 상시개방 | 💰 무료 | 📍 33.9km | 🚗 드라이브 코스 | 📸 일몰 명소", cost: 0, savings: []},
                {name: "고군산군도", location: "군산시 옥도면", details: "🏝️ 섬 여행 | ⏰ 상시 | 💰 다리 통행료 무료 | 📍 무녀도, 신시도, 장자도 | 🚗 드라이브 | 🦞 해산물", cost: 0, savings: []}
              ],
              details: "전북투어패스로 일부 무료 (최대 2,500원 절약). 시간 여유 있을 때 추가 관광",
              cost: 0, saving: 2500, selectedOptions: [0, 5] }
        ];

        let editMode = false;
        let currentFilter = 'all';
        let nextId = 28;
        let currentAddDay = 1;
        let currentEditItemId = null;
        let currentOptionsModalItemId = null;
        let selectedOptions = [];
        let isMultiSelectMode = false;
        let totalDays = 3;

        // Initialize
        function init() {
            loadFromStorage();
            loadAutoCalculateSetting();
            renderSchedule();
            updateStats();
            setupAutoSave();
        }

        // Update main title
        function updateMainTitle(newTitle) {
            const title = newTitle.trim();
            if (title) {
                localStorage.setItem('mainTitle', title);
            }
        }

        // Update day title
        function updateDayTitle(day, newTitle) {
            const title = newTitle.trim();
            if (title) {
                localStorage.setItem(`dayTitle_${day}`, title);
            }
        }

        // Get day title
        function getDayTitle(day) {
            const saved = localStorage.getItem(`dayTitle_${day}`);
            if (saved) return saved;
            
            const defaultTitles = {
                1: '전주 (한옥마을 & 전통문화)',
                2: '전주→군산→선유도',
                3: '군산→수원 (마무리)'
            };
            return defaultTitles[day] || `${day}일차`;
        }

        // Add new day
        function addNewDay() {
            totalDays++;
            localStorage.setItem('totalDays', totalDays);
            renderSchedule();
            showNotification(`${totalDays}일차가 추가되었습니다`);
        }

        // Auto calculate settings
        function loadAutoCalculateSetting() {
            const autoCalc = localStorage.getItem('autoCalculateTime') !== 'false';
            document.getElementById('autoCalculate').checked = autoCalc;
            updateAutoCalculateStatus(autoCalc);
        }

        function toggleAutoCalculate() {
            const isChecked = document.getElementById('autoCalculate').checked;
            localStorage.setItem('autoCalculateTime', isChecked);
            updateAutoCalculateStatus(isChecked);
            showNotification(isChecked ? '자동 시간 계산이 활성화되었습니다' : '자동 시간 계산이 비활성화되었습니다');
        }

        function updateAutoCalculateStatus(isOn) {
            const statusElement = document.getElementById('autoCalculateStatus');
            if (isOn) {
                statusElement.textContent = '자동 계산 ON';
                statusElement.className = 'text-sm px-3 py-1 rounded-full bg-green-100 text-green-800';
            } else {
                statusElement.textContent = '자동 계산 OFF';
                statusElement.className = 'text-sm px-3 py-1 rounded-full bg-gray-100 text-gray-600';
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Render schedule
        function renderSchedule() {
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';

            // Show add day button in edit mode
            const addDayBtn = document.getElementById('addDayBtn');
            if (editMode) {
                addDayBtn.style.display = 'inline-flex';
            } else {
                addDayBtn.style.display = 'none';
            }

            // Render regular days
            for (let day = 1; day <= totalDays; day++) {
                const daySection = createDaySection(day);
                container.appendChild(daySection);
            }

            // Render alternative schedule
            const altSection = createDaySection(0);
            container.appendChild(altSection);
        }

        // Create day section
        function createDaySection(day) {
            const section = document.createElement('div');
            section.className = 'day-section mb-8';

            const header = document.createElement('div');
            header.className = day === 0 ? 'day-header text-white p-4 rounded-t-lg' : 'day-header text-white p-4 rounded-t-lg';
            if (day === 0) {
                header.style.background = 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)';
            }

            const title = day === 0 ? '🔄 대체 일정 옵션' : `📅 ${day}일차 - ${getDayTitle(day)}`;
            const subtitle = day === 0 ? '시간 여유가 있을 때 추가하거나 기존 일정과 교체 가능' : '';

            header.innerHTML = `
                <h2 class="text-xl font-bold ${editMode ? 'editable' : ''}" 
                    ${editMode && day > 0 ? `contenteditable="true" onblur="updateDayTitle(${day}, this.textContent)"` : ''}>${title}</h2>
                ${subtitle ? `<p class="text-sm mt-1 opacity-90">${subtitle}</p>` : ''}
            `;

            const content = document.createElement('div');
            content.className = day === 0 ? 'bg-white rounded-b-lg shadow-lg p-4 relative alternative-section' : 'bg-white rounded-b-lg shadow-lg p-4 relative';
            content.id = `day${day}`;

            // Add module button at the top in edit mode
            if (editMode) {
                const addButton = createAddModuleButton(day);
                content.appendChild(addButton);
            }

            // Add items
            const dayItems = travelData
                .filter(item => item.day === day && shouldShowItem(item))
                .sort((a, b) => {
                    if (day === 0) return 0;
                    return timeToMinutes(a.time) - timeToMinutes(b.time);
                });

            dayItems.forEach((item, index) => {
                const itemElement = createItemElement(item, index);
                content.appendChild(itemElement);
            });

            section.appendChild(header);
            section.appendChild(content);
            return section;
        }

        // Create item element
        function createItemElement(item, index) {
            const div = document.createElement('div');
            div.className = `option-card mb-4 p-4 border-2 rounded-lg transition-all duration-300 ${getModuleClass(item.type)} ${editMode ? 'edit-mode' : ''}`;
            div.dataset.id = item.id;

            // Get day buttons for alternative items
            const getDayButtons = () => {
                let buttons = '';
                for (let d = 1; d <= totalDays; d++) {
                    buttons += `<button onclick="moveToDay(${item.id}, ${d})" class="move-to-day-btn" title="${d}일차로 이동">${d}일</button>`;
                }
                return buttons;
            };

            // Control buttons for edit mode
            const controlButtons = editMode ? `
                <div class="control-buttons">
                    <div class="control-buttons-row">
                        <button onclick="showEditOptionsModal(${item.id})" class="edit-options-btn">
                            <i class="fas fa-list"></i>
                            <span>옵션편집</span>
                        </button>
                    </div>
                    <div class="control-buttons-row">
                        ${item.day > 0 ? `
                            <button onclick="moveItem(${item.id}, -1)" class="p-2 bg-gray-500 text-white rounded hover:bg-gray-600 active:scale-95" title="위로 이동">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button onclick="moveItem(${item.id}, 1)" class="p-2 bg-gray-500 text-white rounded hover:bg-gray-600 active:scale-95" title="아래로 이동">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                            <button onclick="moveToSameTypeItem(${item.id}, -1)" class="p-2 bg-purple-500 text-white rounded hover:bg-purple-600 active:scale-95" title="같은 타입 위로">
                                <i class="fas fa-angle-double-up"></i>
                            </button>
                            <button onclick="moveToSameTypeItem(${item.id}, 1)" class="p-2 bg-purple-500 text-white rounded hover:bg-purple-600 active:scale-95" title="같은 타입 아래로">
                                <i class="fas fa-angle-double-down"></i>
                            </button>
                            <button onclick="moveToAlternative(${item.id})" class="move-to-alternative-btn" title="대체일정으로 이동">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                        ` : getDayButtons()}
                        <button onclick="deleteItem(${item.id})" class="p-2 bg-red-500 text-white rounded hover:bg-red-600 active:scale-95" title="삭제">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            ` : '';

            // Time display
            const timeDisplay = item.time !== '대체' ? `
                ${editMode ? 
                    `<input type="time" class="time-input" value="${item.time}" onchange="updateTime(${item.id}, this.value)">` :
                    `<span class="time-display">
                        <i class="fas fa-clock"></i>
                        ${item.time}
                    </span>`
                }
                <span class="duration-badge">
                    <i class="fas fa-hourglass-half"></i> 
                    ${item.duration}분
                </span>
            ` : '<span class="text-sm font-bold text-gray-600">대체일정</span>';

            // Check for nearby attractions
            const hasNearby = item.details && item.details.includes('인접:');
            const nearbyBadge = hasNearby ? '<span class="nearby-badge"><i class="fas fa-map-marker-alt"></i> 인접관광지</span>' : '';

            // Location badge
            const locationBadge = getLocationBadge(item);

            // Calculate total cost and savings
            const totalCost = calculateTotalCost(item);
            const totalSavings = calculateTotalSavings(item);

            // Cost summary
            const costSummary = totalCost > 0 ? `
                <div class="cost-summary">
                    💰 총 비용: ${totalCost.toLocaleString()}원
                    ${item.selectedOptions && item.selectedOptions.length > 1 ? 
                        `<br><span class="text-xs">(${item.selectedOptions.length}개 옵션 합계)</span>` : ''}
                </div>
            ` : '';

            // Savings summary
            const savingsSummary = totalSavings.length > 0 ? `
                <div class="savings-summary">
                    💚 총 절약: ${totalSavings.reduce((sum, s) => sum + s.amount, 0).toLocaleString()}원
                    <br><span class="text-xs">${totalSavings.map(s => `${s.name}: ${s.amount.toLocaleString()}원`).join(', ')}</span>
                </div>
            ` : '';

            // Selected options display
            const hasMultipleOptions = item.selectedOptions && item.selectedOptions.length > 0;
            const selectedOptionsDisplay = hasMultipleOptions ? createSelectedOptionsDisplay(item) : '';

            // Regular details display
            const detailsDisplay = !hasMultipleOptions && !editMode ? 
                `<div class="text-sm text-gray-600 mb-2">${item.details}</div>` : '';

            div.innerHTML = `
                ${controlButtons}
                <div class="flex items-start justify-between mb-2">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2 flex-wrap">
                            ${timeDisplay}
                            <span class="text-xs px-2 py-1 rounded-full ${getTypeColor(item.type)} ${editMode ? 'editable' : ''}" 
                                  ${editMode ? `contenteditable="true" onblur="updateModule(${item.id}, this.textContent)"` : ''}>${item.module}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-800">${item.status}</span>
                            ${locationBadge}
                            ${nearbyBadge}
                            ${item.edited ? '<span class="text-xs px-2 py-1 rounded-full bg-orange-100 text-orange-800">✏️ 수정됨</span>' : ''}
                        </div>
                        <h4 class="font-bold text-gray-800 text-lg ${editMode ? 'editable' : ''}" 
                            ${editMode ? `contenteditable="true" onblur="updateActivity(${item.id}, this.textContent)"` : ''}>${item.activity}</h4>
                    </div>
                    <div class="flex gap-2 ml-4">
                        ${!editMode ? `
                            <button onclick="showOptions(${item.id})" class="change-button">
                                <i class="fas fa-exchange-alt"></i>
                                <span>변경</span>
                            </button>
                        ` : ''}
                    </div>
                </div>
                
                ${detailsDisplay}
                ${selectedOptionsDisplay}
                ${costSummary}
                ${savingsSummary}
                
                <div class="flex flex-wrap gap-2 text-xs mt-2">
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded-full">${item.options.length}개 옵션</span>
                </div>
            `;

            return div;
        }

        // Calculate total cost from selected options
        function calculateTotalCost(item) {
            if (!item.selectedOptions || item.selectedOptions.length === 0) {
                return item.cost || 0;
            }
            
            let total = 0;
            item.selectedOptions.forEach(optionIndex => {
                const option = item.options[optionIndex];
                if (option && option.cost) {
                    total += option.cost;
                }
            });
            return total;
        }

        // Calculate total savings from selected options
        function calculateTotalSavings(item) {
            const savingsMap = new Map();
            
            if (!item.selectedOptions || item.selectedOptions.length === 0) {
                if (item.saving > 0) {
                    savingsMap.set('전북투어패스', item.saving);
                }
            } else {
                item.selectedOptions.forEach(optionIndex => {
                    const option = item.options[optionIndex];
                    if (option && option.savings && option.savings.length > 0) {
                        option.savings.forEach(saving => {
                            const current = savingsMap.get(saving.name) || 0;
                            savingsMap.set(saving.name, current + saving.amount);
                        });
                    }
                });
            }
            
            const result = [];
            savingsMap.forEach((amount, name) => {
                result.push({ name, amount });
            });
            return result;
        }

        // Move to alternative
        function moveToAlternative(id) {
            const item = travelData.find(i => i.id === id);
            if (!item) return;

            // Find matching alternative module
            const location = getItemLocation(item);
            const alternativeItems = travelData.filter(i => i.day === 0);
            
            let targetModule = null;
            
            // First, try to find exact location match
            if (location) {
                targetModule = alternativeItems.find(alt => {
                    const altLocation = getItemLocation(alt);
                    return altLocation && altLocation === location && getModuleType(alt.module) === getModuleType(item.module);
                });
            }
            
            // If no location match, find by module type
            if (!targetModule) {
                targetModule = alternativeItems.find(alt => 
                    getModuleType(alt.module) === getModuleType(item.module)
                );
            }
            
            // If still no match, create new alternative module
            if (!targetModule) {
                const newModule = {
                    id: nextId++,
                    day: 0,
                    time: "대체",
                    duration: item.duration,
                    activity: `대체 ${getTypeName(item.type)} 옵션`,
                    type: item.type,
                    module: item.module.replace(/🟢|🟡|🔵|🟣|🟠/, '🟡').replace(/모듈/, '대체모듈'),
                    status: "⭕대체옵션",
                    options: [],
                    details: `${location ? location + ' ' : ''}대체 옵션`,
                    cost: 0,
                    saving: 0,
                    edited: true
                };
                travelData.push(newModule);
                targetModule = newModule;
            }
            
            // Add item as option to target module
            const optionData = {
                name: item.activity,
                location: location || '',
                details: item.details,
                cost: item.cost || 0,
                savings: calculateTotalSavings(item)
            };
            
            targetModule.options.push(optionData);
            targetModule.edited = true;
            
            // Remove original item
            const index = travelData.findIndex(i => i.id === id);
            if (index !== -1) {
                travelData.splice(index, 1);
            }
            
            saveToStorage();
            renderSchedule();
            updateStats();
            showNotification(`일정이 대체일정으로 이동되었습니다`);
        }

        // Get item location
        function getItemLocation(item) {
            if (item.options && item.options.length > 0) {
                const firstOption = item.options[0];
                if (firstOption.location) {
                    // Extract city/district
                    const match = firstOption.location.match(/^([가-힣]+시)\s*([가-힣]+구)?/);
                    if (match) {
                        return match[1] + (match[2] ? ' ' + match[2] : '');
                    }
                    return firstOption.location.split(' ')[0];
                }
            }
            return null;
        }

        // Get module type
        function getModuleType(module) {
            if (module.includes('식사')) return 'food';
            if (module.includes('관광')) return 'tour';
            if (module.includes('숙박')) return 'hotel';
            if (module.includes('이동')) return 'transport';
            if (module.includes('특별') || module.includes('명물') || module.includes('마무리')) return 'special';
            return 'tour';
        }

        // Get location badge
        function getLocationBadge(item) {
            const location = getItemLocation(item);
            if (location) {
                return `<span class="location-badge">
                    <i class="fas fa-map-marker-alt"></i> ${location}
                </span>`;
            }
            return '';
        }

        // Create selected options display
        function createSelectedOptionsDisplay(item) {
            if (!item.selectedOptions || item.selectedOptions.length === 0) return '';
            
            const selectedOptionsHtml = item.selectedOptions.map(optionIndex => {
                const option = item.options[optionIndex];
                if (!option) return '';
                
                return `
                    <div class="selected-option-item">
                        <div class="font-semibold text-sm">${option.name}</div>
                        ${option.location ? `<div class="text-xs text-gray-500 mb-1"><i class="fas fa-map-marker-alt"></i> ${option.location}</div>` : ''}
                        <div class="text-xs text-gray-600">${option.details}</div>
                    </div>
                `;
            }).join('');

            return `
                <div class="selected-options-preview">
                    <h5>선택된 옵션들:</h5>
                    ${selectedOptionsHtml}
                </div>
            `;
        }

        // Move to same type item
        function moveToSameTypeItem(id, direction) {
            const item = travelData.find(i => i.id === id);
            if (!item || item.day === 0) return;

            const sameTypeItems = travelData
                .filter(i => i.day === item.day && i.type === item.type)
                .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));

            const currentIndex = sameTypeItems.findIndex(i => i.id === id);
            const targetIndex = currentIndex + direction;

            if (targetIndex < 0 || targetIndex >= sameTypeItems.length) {
                if (direction > 0 && item.day > 0) {
                    // Move to alternative
                    moveToAlternative(id);
                    return;
                }
                showNotification(`더 이상 ${direction > 0 ? '아래' : '위'}에 같은 타입의 일정이 없습니다`);
                return;
            }

            const targetItem = sameTypeItems[targetIndex];
            
            // Swap times
            const tempTime = item.time;
            item.time = targetItem.time;
            targetItem.time = tempTime;
            
            // Auto calculate if enabled
            const autoCalculate = document.getElementById('autoCalculate').checked;
            if (autoCalculate) {
                recalculateDayTimes(item.day);
            }
            
            item.edited = true;
            targetItem.edited = true;
            
            saveToStorage();
            renderSchedule();
            updateStats();
            showSaveIndicator();
            showNotification(`${getTypeName(item.type)} 일정이 이동되었습니다`);
        }

        // Get type name
        function getTypeName(type) {
            const typeNames = {
                'food': '식사',
                'tour': '관광',
                'hotel': '숙박',
                'transport': '이동',
                'special': '특별'
            };
            return typeNames[type] || type;
        }

        // Toggle multi select mode
        function toggleMultiSelectMode() {
            isMultiSelectMode = document.getElementById('multiSelectMode').checked;
            selectedOptions = [];
            
            if (isMultiSelectMode) {
                document.getElementById('multiSelectControls').classList.remove('hidden');
                document.getElementById('modalContent').classList.add('multi-select-mode');
            } else {
                document.getElementById('multiSelectControls').classList.remove('hidden');
                document.getElementById('modalContent').classList.remove('multi-select-mode');
            }
            
            if (currentOptionsModalItemId) {
                renderOptionsModal(currentOptionsModalItemId);
            }
        }

        // Apply selected options
        function applySelectedOptions() {
            if (selectedOptions.length === 0) {
                showNotification('선택된 옵션이 없습니다');
                return;
            }

            const item = travelData.find(i => i.id === currentOptionsModalItemId);
            if (!item) return;

            item.selectedOptions = [...selectedOptions];
            
            const selectedOptionNames = selectedOptions.map(index => item.options[index].name).join(' + ');
            item.activity = selectedOptionNames;
            
            const selectedDetails = selectedOptions.map(index => {
                const option = item.options[index];
                return `[${option.name}] ${option.details}`;
            }).join('\n');
            item.details = selectedDetails;
            
            item.edited = true;
            
            saveToStorage();
            renderSchedule();
            updateStats();
            closeModal();
            showSaveIndicator();
            showNotification(`${selectedOptions.length}개의 옵션이 선택되었습니다`);
        }

        // Clear selected options
        function clearSelectedOptions() {
            selectedOptions = [];
            const checkboxes = document.querySelectorAll('.option-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            showNotification('선택이 취소되었습니다');
        }

        // Toggle option selection
        function toggleOptionSelection(optionIndex) {
            const index = selectedOptions.indexOf(optionIndex);
            if (index > -1) {
                selectedOptions.splice(index, 1);
            } else {
                selectedOptions.push(optionIndex);
            }
        }

        // Show options
        function showOptions(id) {
            currentOptionsModalItemId = id;
            renderOptionsModal(id);
            document.getElementById('optionsModal').classList.remove('hidden');
            disableBodyScroll();
        }

        // Render options modal
        function renderOptionsModal(id) {
            const item = travelData.find(i => i.id === id);
            if (!item) return;

            document.getElementById('modalTitle').innerHTML = `
                <i class="${getTypeIcon(item.type)}"></i> ${item.activity} - 옵션 선택
            `;
            
            const modalContent = document.getElementById('modalContent');
            
            if (isMultiSelectMode) {
                modalContent.innerHTML = item.options.map((option, index) => {
                    const isSelected = selectedOptions.includes(index);
                    return `
                        <div class="option-item p-4 border-2 rounded-lg mb-3 transition-all ${isSelected ? 'border-blue-500 bg-blue-50' : 'hover:border-blue-500 hover:bg-blue-50'}">
                            <input type="checkbox" class="option-checkbox" ${isSelected ? 'checked' : ''} 
                                   onchange="toggleOptionSelection(${index})" id="option-${index}">
                            <label for="option-${index}" class="cursor-pointer">
                                <div class="font-bold text-lg mb-1">${option.name}</div>
                                ${option.location ? `<div class="text-sm text-gray-500 mb-2"><i class="fas fa-map-marker-alt"></i> ${option.location}</div>` : ''}
                                ${option.details ? `<div class="text-sm text-gray-600 whitespace-pre-line">${option.details}</div>` : ''}
                                ${option.cost ? `<div class="text-sm mt-2">💰 비용: ${option.cost.toLocaleString()}원</div>` : ''}
                                ${option.savings && option.savings.length > 0 ? `
                                    <div class="text-sm mt-1">💚 절약: ${option.savings.map(s => `${s.name} ${s.amount.toLocaleString()}원`).join(', ')}</div>
                                ` : ''}
                            </label>
                        </div>
                    `;
                }).join('');
            } else {
                modalContent.innerHTML = item.options.map((option, index) => {
                    return `
                        <div class="option-item p-4 border-2 rounded-lg mb-3 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all"
                             onclick="selectOption(${id}, ${index})">
                            <div class="font-bold text-lg mb-1">${option.name}</div>
                            ${option.location ? `<div class="text-sm text-gray-500 mb-2"><i class="fas fa-map-marker-alt"></i> ${option.location}</div>` : ''}
                            ${option.details ? `<div class="text-sm text-gray-600 whitespace-pre-line">${option.details}</div>` : ''}
                            ${option.cost ? `<div class="text-sm mt-2">💰 비용: ${option.cost.toLocaleString()}원</div>` : ''}
                            ${option.savings && option.savings.length > 0 ? `
                                <div class="text-sm mt-1">💚 절약: ${option.savings.map(s => `${s.name} ${s.amount.toLocaleString()}원`).join(', ')}</div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }
        }

        // Select option
        function selectOption(id, optionIndex) {
            const item = travelData.find(i => i.id === id);
            if (!item) return;

            const option = item.options[optionIndex];
            
            item.activity = option.name;
            if (option.details) {
                item.details = option.details;
            }
            item.selectedOptions = [optionIndex];
            item.edited = true;
            
            saveToStorage();
            renderSchedule();
            updateStats();
            closeModal();
            showSaveIndicator();
        }

        // Create add module button
        function createAddModuleButton(day) {
            const div = document.createElement('div');
            div.className = 'add-module-btn rounded-lg';
            div.onclick = () => showAddModuleModal(day);
            
            const quickAddButtons = day > 0 ? `
                <div class="quick-add-buttons" onclick="event.stopPropagation()">
                    <button onclick="quickAdd(${day}, 'meal')" class="quick-add-btn quick-add-food">
                        <i class="fas fa-utensils"></i> 식사
                    </button>
                    <button onclick="quickAdd(${day}, 'tour')" class="quick-add-btn quick-add-tour">
                        <i class="fas fa-monument"></i> 관광
                    </button>
                    <button onclick="quickAdd(${day}, 'transport')" class="quick-add-btn quick-add-transport">
                        <i class="fas fa-car"></i> 이동
                    </button>
                    <button onclick="quickAdd(${day}, 'rest')" class="quick-add-btn quick-add-rest">
                        <i class="fas fa-coffee"></i> 휴식
                    </button>
                </div>
            ` : '';
            
            div.innerHTML = `
                <i class="fas fa-plus-circle text-3xl text-blue-600 mb-2"></i>
                <div class="text-blue-700 text-lg mb-2">+ 새 일정 추가</div>
                <div class="text-sm text-gray-600">클릭하여 상세 일정 추가</div>
                ${quickAddButtons}
            `;
            return div;
        }

        // Quick add
        function quickAdd(day, type) {
            currentAddDay = day;
            
            const templates = {
                'meal': {
                    activity: '식사',
                    type: 'food',
                    duration: 90,
                    details: '식사 장소와 메뉴를 입력하세요',
                    cost: 10000
                },
                'tour': {
                    activity: '관광지 방문',
                    type: 'tour',
                    duration: 120,
                    details: '관광지 정보를 입력하세요',
                    cost: 0
                },
                'transport': {
                    activity: '이동',
                    type: 'transport',
                    duration: 60,
                    details: '출발지 → 목적지',
                    cost: 5000
                },
                'rest': {
                    activity: '휴식/카페',
                    type: 'special',
                    duration: 60,
                    details: '휴식 장소 정보',
                    cost: 5000
                }
            };
            
            const template = templates[type];
            
            const dayItems = travelData.filter(i => i.day === day);
            let newTime = "09:00";
            
            if (dayItems.length > 0) {
                const lastItem = dayItems.sort((a, b) => timeToMinutes(b.time) - timeToMinutes(a.time))[0];
                const lastEndTime = timeToMinutes(lastItem.time) + (lastItem.duration || 60);
                newTime = minutesToTime(lastEndTime);
            } else {
                const defaultTimes = { 1: "07:00", 2: "08:00", 3: "08:00" };
                newTime = defaultTimes[day] || "09:00";
            }
            
            const moduleMap = {
                'food': '🟢식사모듈',
                'tour': '🟡관광모듈',
                'hotel': '🔵숙박모듈',
                'transport': '🟣이동모듈',
                'special': '🟠특별모듈'
            };
            
            const newItem = {
                id: nextId++,
                day: day,
                time: newTime,
                duration: template.duration,
                activity: template.activity,
                type: template.type,
                module: moduleMap[template.type],
                status: "✅추가됨",
                options: [{name: template.activity, location: "위치 입력", details: template.details, cost: template.cost, savings: []}],
                details: template.details,
                cost: template.cost,
                saving: 0,
                edited: true,
                selectedOptions: [0]
            };
            
            travelData.push(newItem);
            
            if (document.getElementById('autoCalculate').checked) {
                recalculateDayTimes(day);
            }
            
            saveToStorage();
            renderSchedule();
            updateStats();
            showSaveIndicator();
            showNotification(`${template.activity} 일정이 추가되었습니다`);
        }

        // Select template
        function selectTemplate(type) {
            const templates = {
                'meal': {
                    activity: '점심식사',
                    type: 'food',
                    duration: 90,
                    details: '맛집에서 점심식사',
                    cost: 10000
                },
                'tour': {
                    activity: '관광지 방문',
                    type: 'tour',
                    duration: 120,
                    details: '주요 관광지 방문 및 관람',
                    cost: 3000
                },
                'transport': {
                    activity: '이동',
                    type: 'transport',
                    duration: 60,
                    details: '다음 목적지로 이동',
                    cost: 5000
                },
                'rest': {
                    activity: '카페 휴식',
                    type: 'special',
                    duration: 60,
                    details: '카페에서 휴식 및 간식',
                    cost: 8000
                }
            };
            
            const template = templates[type];
            document.getElementById('newActivity').value = template.activity;
            document.getElementById('newType').value = template.type;
            document.getElementById('newDuration').value = template.duration;
            document.getElementById('newDetails').value = template.details;
            document.getElementById('newCost').value = template.cost;
            
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.template-card').classList.add('selected');
        }

        // Move to day
        function moveToDay(id, targetDay) {
            const item = travelData.find(i => i.id === id);
            if (!item) return;

            // If moving from alternative to main day
            if (item.day === 0 && targetDay > 0) {
                // Find last item of same type in target day
                const sameTypeItems = travelData
                    .filter(i => i.day === targetDay && i.type === item.type)
                    .sort((a, b) => timeToMinutes(b.time) - timeToMinutes(a.time));
                
                if (sameTypeItems.length > 0) {
                    // Insert after last same type item
                    const lastItem = sameTypeItems[0];
                    const lastEndTime = timeToMinutes(lastItem.time) + (lastItem.duration || 60);
                    item.time = minutesToTime(lastEndTime);
                } else {
                    // No same type items, add at end of day
                    const dayItems = travelData
                        .filter(i => i.day === targetDay)
                        .sort((a, b) => timeToMinutes(b.time) - timeToMinutes(a.time));
                    
                    if (dayItems.length > 0) {
                        const lastItem = dayItems[0];
                        const lastEndTime = timeToMinutes(lastItem.time) + (lastItem.duration || 60);
                        item.time = minutesToTime(lastEndTime);
                    } else {
                        const defaultTimes = { 1: "09:00", 2: "09:00", 3: "09:00" };
                        item.time = defaultTimes[targetDay] || "09:00";
                    }
                }
                
                // Change module name from alternative to regular
                item.module = item.module.replace('대체', '');
                item.status = "✅현재선택";
            } else if (targetDay === 0) {
                item.time = "대체";
                item.status = "⭕대체옵션";
            } else {
                // Moving between regular days
                const dayItems = travelData
                    .filter(i => i.day === targetDay)
                    .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));
                
                if (dayItems.length > 0) {
                    const lastItem = dayItems[dayItems.length - 1];
                    const lastEndTime = timeToMinutes(lastItem.time) + (lastItem.duration || 60);
                    item.time = minutesToTime(lastEndTime);
                } else {
                    const defaultTimes = { 1: "09:00", 2: "09:00", 3: "09:00" };
                    item.time = defaultTimes[targetDay] || "09:00";
                }
            }

            item.day = targetDay;
            item.edited = true;

            saveToStorage();
            renderSchedule();
            updateStats();
            showSaveIndicator();
            showNotification(`일정이 ${targetDay === 0 ? '대체일정' : targetDay + '일차'}로 이동되었습니다`);
        }

        // Show edit options modal
        function showEditOptionsModal(id) {
            currentEditItemId = id;
            const item = travelData.find(i => i.id === id);
            if (!item) return;

            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';

            item.options.forEach((option, index) => {
                const isSelected = item.selectedOptions && item.selectedOptions.includes(index);
                const canMove = !isSelected || item.day === 0; // Can move if not selected or in alternative

                const optionDiv = document.createElement('div');
                optionDiv.className = 'mb-4 p-4 border rounded-lg bg-gray-50';
                optionDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold">옵션 ${index + 1} ${isSelected ? '<span class="text-green-600">(선택됨)</span>' : ''}</h4>
                        <div class="option-order-buttons">
                            ${canMove && index > 0 ? `<button onclick="moveOption(${index}, -1)" class="option-order-btn" title="위로 이동">
                                <i class="fas fa-arrow-up"></i>
                            </button>` : ''}
                            ${canMove && index < item.options.length - 1 ? `<button onclick="moveOption(${index}, 1)" class="option-order-btn" title="아래로 이동">
                                <i class="fas fa-arrow-down"></i>
                            </button>` : ''}
                            ${canMove && item.day > 0 ? `<button onclick="moveOptionToSameType(${index}, -1)" class="option-order-btn bg-purple-600" title="같은 타입 위로">
                                <i class="fas fa-angle-double-up"></i>
                            </button>` : ''}
                            ${canMove && item.day > 0 ? `<button onclick="moveOptionToSameType(${index}, 1)" class="option-order-btn bg-purple-600" title="같은 타입 아래로">
                                <i class="fas fa-angle-double-down"></i>
                            </button>` : ''}
                            ${item.day > 0 ? `<button onclick="moveOptionToAlternative(${index})" class="option-order-btn bg-gray-600" title="대체일정으로">
                                <i class="fas fa-exchange-alt"></i>
                            </button>` : ''}
                            ${item.day === 0 ? getDayButtonsForOption(index) : ''}
                            <button onclick="deleteOption(${index})" class="text-red-500 hover:text-red-700 ml-2">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-2">
                        <label class="block text-sm font-medium mb-1">옵션명</label>
                        <input type="text" class="w-full p-2 border rounded" value="${option.name}" 
                               onchange="updateOption(${index}, 'name', this.value)">
                    </div>
                    <div class="mb-2">
                        <label class="block text-sm font-medium mb-1">위치</label>
                        <input type="text" class="w-full p-2 border rounded" value="${option.location || ''}" 
                               onchange="updateOption(${index}, 'location', this.value)" placeholder="예: 전주시 완산구 교동">
                    </div>
                    <div class="mb-2">
                        <label class="block text-sm font-medium mb-1">상세 설명</label>
                        <textarea class="w-full p-2 border rounded" rows="3" 
                                  onchange="updateOption(${index}, 'details', this.value)">${option.details || ''}</textarea>
                    </div>
                    <div class="mb-2">
                        <label class="block text-sm font-medium mb-1">비용</label>
                        <div class="duration-input-wrapper" style="width: 150px;">
                            <button class="duration-btn" onclick="changeOptionCost(${index}, -1000)">-</button>
                            <input type="number" class="duration-input" style="width: 80px;" value="${option.cost || 0}" 
                                   onchange="updateOption(${index}, 'cost', parseInt(this.value) || 0)" min="0" step="1000">
                            <button class="duration-btn" onclick="changeOptionCost(${index}, 1000)">+</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">절약 항목</label>
                        <div class="saving-items" id="savingItems_${index}">
                            ${renderSavingItems(option.savings || [], index)}
                        </div>
                        <button onclick="addSavingItem(${index})" class="mt-2 text-sm bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">
                            <i class="fas fa-plus"></i> 절약 항목 추가
                        </button>
                    </div>
                `;
                optionsList.appendChild(optionDiv);
            });

            document.getElementById('editOptionsModal').classList.remove('hidden');
            disableBodyScroll();
        }

        // Get day buttons for option
        function getDayButtonsForOption(optionIndex) {
            let buttons = '';
            for (let d = 1; d <= totalDays; d++) {
                buttons += `<button onclick="moveOptionToDay(${optionIndex}, ${d})" class="option-order-btn bg-green-600 ml-1" title="${d}일차로">
                    ${d}일
                </button>`;
            }
            return buttons;
        }

        // Move option to day
        function moveOptionToDay(optionIndex, targetDay) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex]) return;

            const option = item.options[optionIndex];
            
            // Find or create target item in the day
            const sameTypeItems = travelData.filter(i => 
                i.day === targetDay && i.type === item.type
            ).sort((a, b) => timeToMinutes(b.time) - timeToMinutes(a.time));

            let targetItem;
            if (sameTypeItems.length > 0) {
                targetItem = sameTypeItems[0]; // Add to last item of same type
            } else {
                // Create new item
                const dayItems = travelData.filter(i => i.day === targetDay);
                let newTime = "09:00";
                
                if (dayItems.length > 0) {
                    const lastItem = dayItems.sort((a, b) => timeToMinutes(b.time) - timeToMinutes(a.time))[0];
                    const lastEndTime = timeToMinutes(lastItem.time) + (lastItem.duration || 60);
                    newTime = minutesToTime(lastEndTime);
                }

                targetItem = {
                    id: nextId++,
                    day: targetDay,
                    time: newTime,
                    duration: item.duration,
                    activity: option.name,
                    type: item.type,
                    module: item.module.replace('대체', ''),
                    status: "✅현재선택",
                    options: [],
                    details: option.details,
                    cost: option.cost || 0,
                    saving: 0,
                    edited: true,
                    selectedOptions: [0]
                };
                travelData.push(targetItem);
            }

            // Add option to target item
            targetItem.options.push({...option});
            targetItem.edited = true;

            // Remove from current item
            item.options.splice(optionIndex, 1);
            
            // If this was the last option, remove the item
            if (item.options.length === 0) {
                const itemIndex = travelData.findIndex(i => i.id === item.id);
                if (itemIndex !== -1) {
                    travelData.splice(itemIndex, 1);
                }
                closeEditOptionsModal();
            } else {
                // Update selected options if needed
                if (item.selectedOptions) {
                    item.selectedOptions = item.selectedOptions
                        .filter(i => i !== optionIndex)
                        .map(i => i > optionIndex ? i - 1 : i);
                }
            }

            saveToStorage();
            renderSchedule();
            updateStats();
            showNotification(`옵션이 ${targetDay}일차로 이동되었습니다`);
            
            if (item.options.length > 0) {
                showEditOptionsModal(currentEditItemId);
            }
        }

        // Move option to alternative
        function moveOptionToAlternative(optionIndex) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex]) return;

            const option = item.options[optionIndex];
            const location = option.location ? option.location.split(' ')[0] : null;
            
            // Find matching alternative module
            const alternativeItems = travelData.filter(i => i.day === 0);
            let targetModule = null;
            
            if (location) {
                targetModule = alternativeItems.find(alt => {
                    const altLocation = getItemLocation(alt);
                    return altLocation && altLocation.includes(location) && getModuleType(alt.module) === item.type;
                });
            }
            
            if (!targetModule) {
                targetModule = alternativeItems.find(alt => 
                    getModuleType(alt.module) === item.type
                );
            }
            
            if (!targetModule) {
                const newModule = {
                    id: nextId++,
                    day: 0,
                    time: "대체",
                    duration: item.duration,
                    activity: `대체 ${getTypeName(item.type)} 옵션`,
                    type: item.type,
                    module: item.module.replace(/🟢|🟡|🔵|🟣|🟠/, '🟡').replace(/모듈/, '대체모듈'),
                    status: "⭕대체옵션",
                    options: [],
                    details: `${location ? location + ' ' : ''}대체 옵션`,
                    cost: 0,
                    saving: 0,
                    edited: true
                };
                travelData.push(newModule);
                targetModule = newModule;
            }
            
            targetModule.options.push({...option});
            targetModule.edited = true;
            
            // Remove from current item
            item.options.splice(optionIndex, 1);
            
            if (item.options.length === 0) {
                const itemIndex = travelData.findIndex(i => i.id === item.id);
                if (itemIndex !== -1) {
                    travelData.splice(itemIndex, 1);
                }
                closeEditOptionsModal();
            } else {
                if (item.selectedOptions) {
                    item.selectedOptions = item.selectedOptions
                        .filter(i => i !== optionIndex)
                        .map(i => i > optionIndex ? i - 1 : i);
                }
            }

            saveToStorage();
            renderSchedule();
            updateStats();
            showNotification('옵션이 대체일정으로 이동되었습니다');
            
            if (item.options.length > 0) {
                showEditOptionsModal(currentEditItemId);
            }
        }

        // Move option to same type
        function moveOptionToSameType(optionIndex, direction) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex]) return;

            const option = item.options[optionIndex];
            const sameTypeItems = travelData
                .filter(i => i.day === item.day && i.type === item.type && i.id !== item.id)
                .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));

            if (sameTypeItems.length === 0) {
                if (direction > 0 && item.day > 0) {
                    moveOptionToAlternative(optionIndex);
                    return;
                }
                showNotification('같은 타입의 다른 일정이 없습니다');
                return;
            }

            const targetItem = direction > 0 ? 
                sameTypeItems[sameTypeItems.length - 1] : 
                sameTypeItems[0];

            targetItem.options.push({...option});
            targetItem.edited = true;

            // Remove from current item
            item.options.splice(optionIndex, 1);
            
            if (item.options.length === 0) {
                const itemIndex = travelData.findIndex(i => i.id === item.id);
                if (itemIndex !== -1) {
                    travelData.splice(itemIndex, 1);
                }
                closeEditOptionsModal();
            } else {
                if (item.selectedOptions) {
                    item.selectedOptions = item.selectedOptions
                        .filter(i => i !== optionIndex)
                        .map(i => i > optionIndex ? i - 1 : i);
                }
            }

            saveToStorage();
            renderSchedule();
            updateStats();
            showNotification(`옵션이 ${direction > 0 ? '아래' : '위'} ${getTypeName(item.type)} 일정으로 이동되었습니다`);
            
            if (item.options.length > 0) {
                showEditOptionsModal(currentEditItemId);
            }
        }

        // Render saving items
        function renderSavingItems(savings, optionIndex) {
            if (!savings || savings.length === 0) {
                return '<div class="text-sm text-gray-500">절약 항목이 없습니다</div>';
            }
            
            return savings.map((saving, savingIndex) => `
                <div class="saving-item">
                    <input type="text" placeholder="항목명" value="${saving.name || ''}" 
                           onchange="updateSavingItem(${optionIndex}, ${savingIndex}, 'name', this.value)"
                           class="flex-1">
                    <div class="duration-input-wrapper" style="width: 120px;">
                        <button class="duration-btn" onclick="changeSavingAmount(${optionIndex}, ${savingIndex}, -100)">-</button>
                        <input type="number" placeholder="금액" value="${saving.amount || 0}" 
                               onchange="updateSavingItem(${optionIndex}, ${savingIndex}, 'amount', parseInt(this.value) || 0)"
                               class="amount-input duration-input" style="width: 60px;" min="0" step="100">
                        <button class="duration-btn" onclick="changeSavingAmount(${optionIndex}, ${savingIndex}, 100)">+</button>
                    </div>
                    <button onclick="deleteSavingItem(${optionIndex}, ${savingIndex})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        // Add saving item
        function addSavingItem(optionIndex) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex]) return;

            if (!item.options[optionIndex].savings) {
                item.options[optionIndex].savings = [];
            }
            
            item.options[optionIndex].savings.push({ name: '전북투어패스', amount: 0 });
            item.edited = true;
            
            saveToStorage();
            updateStats();
            
            // Refresh saving items display
            const container = document.getElementById(`savingItems_${optionIndex}`);
            if (container) {
                container.innerHTML = renderSavingItems(item.options[optionIndex].savings, optionIndex);
            }
        }

        // Update saving item
        function updateSavingItem(optionIndex, savingIndex, field, value) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex] || !item.options[optionIndex].savings[savingIndex]) return;

            item.options[optionIndex].savings[savingIndex][field] = value;
            item.edited = true;
            
            saveToStorage();
            updateStats();
        }

        // Change saving amount
        function changeSavingAmount(optionIndex, savingIndex, change) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex] || !item.options[optionIndex].savings[savingIndex]) return;

            const currentAmount = item.options[optionIndex].savings[savingIndex].amount || 0;
            item.options[optionIndex].savings[savingIndex].amount = Math.max(0, currentAmount + change);
            item.edited = true;
            
            saveToStorage();
            updateStats();
            
            // Refresh saving items display
            const container = document.getElementById(`savingItems_${optionIndex}`);
            if (container) {
                container.innerHTML = renderSavingItems(item.options[optionIndex].savings, optionIndex);
            }
        }

        // Delete saving item
        function deleteSavingItem(optionIndex, savingIndex) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex] || !item.options[optionIndex].savings) return;

            item.options[optionIndex].savings.splice(savingIndex, 1);
            item.edited = true;
            
            saveToStorage();
            updateStats();
            
            // Refresh saving items display
            const container = document.getElementById(`savingItems_${optionIndex}`);
            if (container) {
                container.innerHTML = renderSavingItems(item.options[optionIndex].savings, optionIndex);
            }
        }

        // Change option cost
        function changeOptionCost(optionIndex, change) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[optionIndex]) return;

            const currentCost = item.options[optionIndex].cost || 0;
            item.options[optionIndex].cost = Math.max(0, currentCost + change);
            item.edited = true;
            
            saveToStorage();
            updateStats();
            showEditOptionsModal(currentEditItemId);
        }

        // Move option
        function moveOption(index, direction) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item) return;

            const targetIndex = index + direction;
            if (targetIndex < 0 || targetIndex >= item.options.length) return;

            const temp = item.options[index];
            item.options[index] = item.options[targetIndex];
            item.options[targetIndex] = temp;

            // Update selected options
            if (item.selectedOptions) {
                item.selectedOptions = item.selectedOptions.map(i => {
                    if (i === index) return targetIndex;
                    if (i === targetIndex) return index;
                    return i;
                });
            }

            item.edited = true;
            saveToStorage();
            updateStats();
            showEditOptionsModal(currentEditItemId);
        }

        // Update option
        function updateOption(index, field, value) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || !item.options[index]) return;

            item.options[index][field] = value;
            item.edited = true;
            saveToStorage();
            updateStats();
        }

        // Delete option
        function deleteOption(index) {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item || item.options.length <= 1) return;

            if (confirm('이 옵션을 삭제하시겠습니까?')) {
                item.options.splice(index, 1);
                
                // Update selected options
                if (item.selectedOptions) {
                    item.selectedOptions = item.selectedOptions
                        .filter(i => i !== index)
                        .map(i => i > index ? i - 1 : i);
                }
                
                item.edited = true;
                saveToStorage();
                updateStats();
                showEditOptionsModal(currentEditItemId);
            }
        }

        // Add new option
        function addNewOption() {
            const item = travelData.find(i => i.id === currentEditItemId);
            if (!item) return;

            item.options.push({ 
                name: '새 옵션', 
                location: '위치 입력', 
                details: '상세 설명을 입력하세요',
                cost: 0,
                savings: []
            });
            item.edited = true;
            saveToStorage();
            updateStats();
            showEditOptionsModal(currentEditItemId);
        }

        // Close edit options modal
        function closeEditOptionsModal() {
            document.getElementById('editOptionsModal').classList.add('hidden');
            currentEditItemId = null;
            renderSchedule();
            enableBodyScroll();
        }

        // Move item
        function moveItem(id, direction) {
            const item = travelData.find(i => i.id === id);
            if (!item || item.day === 0) return;

            const dayItems = travelData
                .filter(i => i.day === item.day)
                .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));

            const currentIndex = dayItems.findIndex(i => i.id === id);
            const targetIndex = currentIndex + direction;

            if (targetIndex < 0 || targetIndex >= dayItems.length) return;

            const targetItem = dayItems[targetIndex];
            
            const tempTime = item.time;
            item.time = targetItem.time;
            targetItem.time = tempTime;
            
            const autoCalculate = document.getElementById('autoCalculate').checked;
            if (autoCalculate) {
                recalculateDayTimes(item.day);
            }
            
            item.edited = true;
            targetItem.edited = true;
            
            saveToStorage();
            renderSchedule();
            updateStats();
            showSaveIndicator();
        }

        // Recalculate all times
        function recalculateAllTimes() {
            for (let day = 1; day <= totalDays; day++) {
                recalculateDayTimes(day);
            }
            saveToStorage();
            renderSchedule();
            updateStats();
            showSaveIndicator();
            showNotification('모든 일정의 시간이 재계산되었습니다');
        }

        // Recalculate times for a day
        function recalculateDayTimes(day) {
            const dayItems = travelData
                .filter(i => i.day === day)
                .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));

            if (dayItems.length <= 1) return;

            for (let i = 1; i < dayItems.length; i++) {
                const prevItem = dayItems[i - 1];
                const prevEndTime = timeToMinutes(prevItem.time) + (prevItem.duration || 60);
                dayItems[i].time = minutesToTime(prevEndTime);
                dayItems[i].edited = true;
            }
        }

        // Time utilities
        function timeToMinutes(time) {
            if (!time || time === '대체') return 0;
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function minutesToTime(minutes) {
            const hours = Math.floor(minutes / 60) % 24;
            const mins = minutes % 60;
            return `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
        }

        // Update functions
        function updateTime(id, newTime) {
            const item = travelData.find(i => i.id === id);
            if (item && /^\d{2}:\d{2}$/.test(newTime)) {
                item.time = newTime;
                item.edited = true;
                saveToStorage();
                updateStats();
            }
        }

        function updateDuration(id, newDuration) {
            const duration = parseInt(newDuration);
            if (!isNaN(duration) && duration >= 0) {
                const item = travelData.find(i => i.id === id);
                if (item) {
                    item.duration = duration;
                    item.edited = true;
                    saveToStorage();
                    updateStats();
                }
            }
        }

        function updateModule(id, newModule) {
            const item = travelData.find(i => i.id === id);
            if (item) {
                item.module = newModule.trim();
                item.edited = true;
                saveToStorage();
                updateStats();
            }
        }

        function updateActivity(id, newActivity) {
            const item = travelData.find(i => i.id === id);
            if (item) {
                item.activity = newActivity.trim();
                item.edited = true;
                saveToStorage();
                updateStats();
            }
        }

        // Delete item
        function deleteItem(id) {
            if (confirm('이 일정을 삭제하시겠습니까?')) {
                const index = travelData.findIndex(i => i.id === id);
                if (index !== -1) {
                    travelData.splice(index, 1);
                    saveToStorage();
                    renderSchedule();
                    updateStats();
                    showSaveIndicator();
                }
            }
        }

        // Show add module modal
        function showAddModuleModal(day) {
            currentAddDay = day;
            
            if (day === 0) {
                document.getElementById('newTime').value = "00:00";
                document.getElementById('newTime').parentElement.style.display = 'none';
            } else {
                document.getElementById('newTime').parentElement.style.display = 'block';
                
                const dayItems = travelData.filter(i => i.day === day);
                if (dayItems.length > 0) {
                    const lastItem = dayItems.sort((a, b) => timeToMinutes(b.time) - timeToMinutes(a.time))[0];
                    const lastEndTime = timeToMinutes(lastItem.time) + (lastItem.duration || 60);
                    document.getElementById('newTime').value = minutesToTime(lastEndTime);
                } else {
                    const defaultTimes = { 1: "07:00", 2: "08:00", 3: "08:00" };
                    document.getElementById('newTime').value = defaultTimes[day] || "09:00";
                }
            }
            
            document.getElementById('newActivity').value = '';
            document.getElementById('newType').value = 'tour';
            document.getElementById('newDuration').value = '60';
            document.getElementById('newDetails').value = '';
            document.getElementById('newCost').value = '0';
            
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.getElementById('addModuleModal').classList.remove('hidden');
            disableBodyScroll();
        }

        // Add new module
        function addNewModule() {
            const time = currentAddDay === 0 ? "대체" : document.getElementById('newTime').value;
            const activity = document.getElementById('newActivity').value.trim();
            const type = document.getElementById('newType').value;
            const duration = parseInt(document.getElementById('newDuration').value) || 60;
            const details = document.getElementById('newDetails').value.trim();
            const cost = parseInt(document.getElementById('newCost').value) || 0;
            
            if (!activity) {
                alert('활동명을 입력해주세요.');
                return;
            }
            
            const moduleMap = {
                'food': currentAddDay === 0 ? '🟡대체식사모듈' : '🟢식사모듈',
                'tour': currentAddDay === 0 ? '🟡대체관광모듈' : '🟡관광모듈',
                'hotel': currentAddDay === 0 ? '🟡대체숙박모듈' : '🔵숙박모듈',
                'transport': currentAddDay === 0 ? '🟡대체이동모듈' : '🟣이동모듈',
                'special': currentAddDay === 0 ? '🟡대체특별모듈' : '🟠특별모듈'
            };
            
            const newItem = {
                id: nextId++,
                day: currentAddDay,
                time: time,
                duration: duration,
                activity: activity,
                type: type,
                module: moduleMap[type],
                status: currentAddDay === 0 ? "⭕대체옵션" : "✅추가됨",
                options: [{name: activity, location: "위치 입력", details: details, cost: cost, savings: []}],
                details: details || `${activity} 관련 상세 정보`,
                cost: cost,
                saving: 0,
                edited: true,
                selectedOptions: [0]
            };
            
            travelData.push(newItem);
            
            closeAddModal();
            saveToStorage();
            renderSchedule();
            updateStats();
            showSaveIndicator();
            showNotification('새 일정이 추가되었습니다');
        }

        // Close modals
        function closeModal() {
            document.getElementById('optionsModal').classList.add('hidden');
            enableBodyScroll();
            document.getElementById('multiSelectMode').checked = false;
            toggleMultiSelectMode();
            currentOptionsModalItemId = null;
        }

        function closeAddModal() {
            document.getElementById('addModuleModal').classList.add('hidden');
            enableBodyScroll();
        }

        // Toggle edit mode
        function toggleEditMode() {
            editMode = !editMode;
            const btn = document.querySelector('button[onclick="toggleEditMode()"]');
            
            if (editMode) {
                btn.className = 'main-control-btn green';
                btn.innerHTML = '<i class="fas fa-check"></i><span>편집완료</span>';
                
                // Load main title
                const savedTitle = localStorage.getItem('mainTitle');
                if (savedTitle) {
                    document.getElementById('mainTitle').textContent = savedTitle;
                }
                
                showNotification('편집모드가 활성화되었습니다');
            } else {
                btn.className = 'main-control-btn orange';
                btn.innerHTML = '<i class="fas fa-edit"></i><span>편집모드</span>';
                showNotification('편집모드가 종료되었습니다');
            }
            
            renderSchedule();
        }

        // Save schedule
        function saveSchedule() {
            saveToStorage();
            showSaveIndicator();
        }

        // Show save indicator
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        // Auto save
        function setupAutoSave() {
            setInterval(() => {
                if (editMode) {
                    saveToStorage();
                }
            }, 10000);
        }

        // Filter functions
        function filterByType(type) {
            currentFilter = type;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200');
            });
            
            event.target.classList.remove('bg-gray-200');
            event.target.classList.add('bg-blue-500', 'text-white');
            
            renderSchedule();
        }

        function shouldShowItem(item) {
            if (currentFilter === 'all') return true;
            return item.type === currentFilter;
        }

        // Get type icon
        function getTypeIcon(type) {
            const icons = {
                'food': 'fas fa-utensils',
                'tour': 'fas fa-monument',
                'hotel': 'fas fa-bed',
                'transport': 'fas fa-car',
                'special': 'fas fa-star'
            };
            return icons[type] || 'fas fa-calendar';
        }

        // Get module class
        function getModuleClass(type) {
            const classes = {
                'food': 'border-green-300',
                'tour': 'border-yellow-300',
                'hotel': 'border-blue-300',
                'transport': 'border-purple-300',
                'special': 'border-red-300'
            };
            return classes[type] || 'border-gray-300';
        }

        // Get type color
        function getTypeColor(type) {
            const colors = {
                'food': 'bg-green-200 text-green-800',
                'tour': 'bg-yellow-200 text-yellow-800',
                'hotel': 'bg-blue-200 text-blue-800',
                'transport': 'bg-purple-200 text-purple-800',
                'special': 'bg-red-200 text-red-800'
            };
            return colors[type] || 'bg-gray-200 text-gray-800';
        }

        // Update stats
        function updateStats() {
            let totalCost = 0;
            const savingsMap = new Map();
            let editedCount = 0;
            let totalItems = 0;

            travelData.forEach(item => {
                if (item.day > 0) {
                    totalItems++;
                    totalCost += calculateTotalCost(item);
                    
                    const savings = calculateTotalSavings(item);
                    savings.forEach(saving => {
                        const current = savingsMap.get(saving.name) || 0;
                        savingsMap.set(saving.name, current + saving.amount);
                    });
                }
                if (item.edited) editedCount++;
            });

            // Display stats
            document.getElementById('totalBudget').textContent = `₩${totalCost.toLocaleString()}`;
            document.getElementById('editedItems').textContent = editedCount;
            document.getElementById('totalItems').textContent = totalItems;

            // Display all savings
            const totalSavings = Array.from(savingsMap.values()).reduce((sum, amount) => sum + amount, 0);
            document.getElementById('totalSavings').textContent = `₩${totalSavings.toLocaleString()}`;
            
            // Display savings categories
            const savingsCategories = Array.from(savingsMap.entries())
                .map(([name, amount]) => `${name}: ₩${amount.toLocaleString()}`)
                .join('<br>');
            document.getElementById('savingsCategories').innerHTML = savingsCategories || '절약 없음';
        }

        // Export schedule
        function exportSchedule() {
            const mainTitle = document.getElementById('mainTitle').textContent.trim();
            let exportText = `📋 ${mainTitle}\n`;
            exportText += "=" .repeat(50) + "\n\n";
            
            for (let day = 1; day <= totalDays; day++) {
                exportText += `📅 ${day}일차 - ${getDayTitle(day)}\n`;
                exportText += "-" .repeat(40) + "\n";
                
                const dayItems = travelData
                    .filter(item => item.day === day)
                    .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));
                
                let lastEndTime = null;
                dayItems.forEach(item => {
                    const endTime = timeToMinutes(item.time) + (item.duration || 0);
                    exportText += `\n⏰ ${item.time} - ${minutesToTime(endTime)} | ${item.activity}\n`;
                    
                    if (item.options && item.options[0] && item.options[0].location) {
                        exportText += `   📍 위치: ${item.options[0].location}\n`;
                    }
                    
                    if (item.selectedOptions && item.selectedOptions.length > 0) {
                        exportText += `   ✅ 선택된 옵션들:\n`;
                        item.selectedOptions.forEach(optionIndex => {
                            const option = item.options[optionIndex];
                            if (option) {
                                exportText += `      - ${option.name}\n`;
                                if (option.location) {
                                    exportText += `        📍 ${option.location}\n`;
                                }
                                exportText += `        ${option.details}\n`;
                                if (option.cost > 0) {
                                    exportText += `        💰 ${option.cost.toLocaleString()}원\n`;
                                }
                                if (option.savings && option.savings.length > 0) {
                                    option.savings.forEach(saving => {
                                        exportText += `        💚 ${saving.name}: ${saving.amount.toLocaleString()}원 절약\n`;
                                    });
                                }
                            }
                        });
                    } else {
                        exportText += `   📝 ${item.details}\n`;
                    }
                    
                    const totalCost = calculateTotalCost(item);
                    const totalSavings = calculateTotalSavings(item);
                    
                    if (totalCost > 0) exportText += `   💰 총 비용: ${totalCost.toLocaleString()}원\n`;
                    if (totalSavings.length > 0) {
                        totalSavings.forEach(saving => {
                            exportText += `   💚 ${saving.name} 절약: ${saving.amount.toLocaleString()}원\n`;
                        });
                    }
                    exportText += `   ⏱️ 소요시간: ${item.duration}분\n`;
                    
                    if (item.details && item.details.includes('인접:')) {
                        const nearbyMatch = item.details.match(/🏛️ 인접: ([^|]+)/);
                        if (nearbyMatch) {
                            exportText += `   🗺️ 인접 관광지: ${nearbyMatch[1]}\n`;
                        }
                    }
                    
                    lastEndTime = endTime;
                });
                
                if (lastEndTime) {
                    exportText += `\n📌 ${day}일차 종료 시간: ${minutesToTime(lastEndTime)}\n`;
                }
                exportText += "\n";
            }

            // Add alternatives
            const alternatives = travelData.filter(item => item.day === 0);
            if (alternatives.length > 0) {
                exportText += "\n🔄 대체 일정 옵션\n";
                exportText += "-" .repeat(40) + "\n";
                alternatives.forEach(item => {
                    exportText += `\n• ${item.activity}\n`;
                    item.options.forEach(option => {
                        exportText += `  - ${option.name}\n`;
                        if (option.location) {
                            exportText += `    📍 ${option.location}\n`;
                        }
                        exportText += `    ${option.details}\n`;
                        if (option.cost > 0) {
                            exportText += `    💰 ${option.cost.toLocaleString()}원\n`;
                        }
                        if (option.savings && option.savings.length > 0) {
                            option.savings.forEach(saving => {
                                exportText += `    💚 ${saving.name}: ${saving.amount.toLocaleString()}원 절약\n`;
                            });
                        }
                    });
                });
            }

            // Calculate totals
            let totalCost = 0;
            const savingsMap = new Map();
            
            travelData.forEach(item => {
                if (item.day > 0) {
                    totalCost += calculateTotalCost(item);
                    const savings = calculateTotalSavings(item);
                    savings.forEach(saving => {
                        const current = savingsMap.get(saving.name) || 0;
                        savingsMap.set(saving.name, current + saving.amount);
                    });
                }
            });
            
            const totalSavingsAmount = Array.from(savingsMap.values()).reduce((sum, amount) => sum + amount, 0);
            
            exportText += "\n" + "=" .repeat(50) + "\n";
            exportText += `💰 총 예상 비용: ${totalCost.toLocaleString()}원\n`;
            savingsMap.forEach((amount, name) => {
                exportText += `💚 ${name} 총 절약: ${amount.toLocaleString()}원\n`;
            });
            exportText += `📊 순 비용: ${(totalCost - totalSavingsAmount).toLocaleString()}원\n`;
            exportText += `\n📝 수정된 항목: ${travelData.filter(item => item.edited).length}개\n`;
            exportText += `🗓️ 생성일: ${new Date().toLocaleDateString('ko-KR')}\n`;

            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${mainTitle.replace(/[^가-힣a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('일정이 다운로드되었습니다');
        }

        // Reset schedule
        function resetSchedule() {
            if (confirm('모든 변경사항을 초기화하시겠습니까?\n저장된 모든 수정 내용이 삭제됩니다.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Storage functions
        function saveToStorage() {
            localStorage.setItem('travelPlannerData', JSON.stringify(travelData));
            localStorage.setItem('travelPlannerNextId', nextId.toString());
            localStorage.setItem('totalDays', totalDays.toString());
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('travelPlannerData');
            const savedNextId = localStorage.getItem('travelPlannerNextId');
            const savedTotalDays = localStorage.getItem('totalDays');
            const savedMainTitle = localStorage.getItem('mainTitle');
            
            if (savedNextId) {
                nextId = parseInt(savedNextId);
            }
            
            if (savedTotalDays) {
                totalDays = parseInt(savedTotalDays);
            }
            
            if (savedMainTitle) {
                document.getElementById('mainTitle').textContent = savedMainTitle;
            }
            
            if (saved) {
                try {
                    const savedData = JSON.parse(saved);
                    travelData.length = 0;
                    travelData.push(...savedData);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        // Modal scroll control
        function disableBodyScroll() {
            document.body.style.overflow = 'hidden';
            document.body.style.touchAction = 'none';
        }

        function enableBodyScroll() {
            document.body.style.overflow = 'auto';
            document.body.style.touchAction = 'auto';
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);

        // Close modals on outside click
        document.getElementById('optionsModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        document.getElementById('addModuleModal').addEventListener('click', function(e) {
            if (e.target === this) closeAddModal();
        });

        document.getElementById('editOptionsModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditOptionsModal();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveSchedule();
            }
            if (e.key === 'Escape') {
                closeModal();
                closeAddModal();
                closeEditOptionsModal();
            }
        });
    </script>
</body>
</html>
